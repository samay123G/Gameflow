<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GameFlow ‚Äî Play. Win. Repeat.</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<style>
/* ===================== VARIABLES ===================== */
:root{
  --black:#080808;--dark:#111;--card:#161616;--card2:#1e1e1e;
  --orange:#ff6600;--orange2:#ff8833;--orange3:#ffaa55;
  --oglow:rgba(255,102,0,0.25);--oglow2:rgba(255,102,0,0.08);
  --white:#fff;--gray:#999;--gray2:#555;--border:rgba(255,102,0,0.15);
  --radius:14px;--radius2:10px;
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{font-family:'Exo 2',sans-serif;background:var(--black);color:var(--white);overflow-x:hidden;cursor:default;}
::-webkit-scrollbar{width:5px;}::-webkit-scrollbar-track{background:var(--dark);}::-webkit-scrollbar-thumb{background:var(--orange);border-radius:3px;}

/* ===================== HEADER ===================== */
header{position:fixed;top:0;width:100%;z-index:900;background:rgba(8,8,8,0.92);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border);}
.hdr{max-width:1280px;margin:0 auto;display:flex;align-items:center;gap:2rem;padding:0 1.5rem;height:62px;}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;flex-shrink:0;}
.logo-box{width:36px;height:36px;background:linear-gradient(135deg,var(--orange),var(--orange2));border-radius:8px;display:grid;place-items:center;font-size:18px;box-shadow:0 0 20px var(--oglow);}
.logo-text{font-family:'Orbitron',monospace;font-weight:900;font-size:1.3rem;letter-spacing:1px;}
.logo-text span{color:var(--orange);}
nav{display:flex;gap:0.2rem;flex:1;}
nav a{color:var(--gray);text-decoration:none;padding:6px 14px;border-radius:8px;font-weight:600;font-size:0.9rem;transition:all 0.2s;letter-spacing:0.3px;}
nav a:hover{color:var(--white);background:rgba(255,255,255,0.05);}
nav a.active{color:var(--orange);}
.hdr-right{display:flex;align-items:center;gap:10px;flex-shrink:0;}
.search-wrap{position:relative;}
.search-wrap input{background:rgba(255,255,255,0.05);border:1px solid var(--border);color:var(--white);padding:7px 14px 7px 36px;border-radius:20px;font-size:0.85rem;font-family:'Exo 2',sans-serif;width:180px;transition:all 0.3s;}
.search-wrap input:focus{outline:none;border-color:var(--orange);width:220px;background:rgba(255,102,0,0.05);}
.search-wrap input::placeholder{color:var(--gray2);}
.search-icon{position:absolute;left:11px;top:50%;transform:translateY(-50%);color:var(--gray2);font-size:14px;pointer-events:none;}
.btn{padding:8px 20px;border-radius:8px;font-family:'Exo 2',sans-serif;font-weight:700;font-size:0.88rem;cursor:pointer;border:none;transition:all 0.2s;letter-spacing:0.3px;}
.btn-ghost{background:transparent;color:var(--orange);border:1.5px solid var(--orange);}
.btn-ghost:hover{background:var(--orange);color:#fff;}
.btn-fill{background:linear-gradient(135deg,var(--orange),var(--orange2));color:#fff;box-shadow:0 4px 15px var(--oglow);}
.btn-fill:hover{transform:translateY(-1px);box-shadow:0 6px 20px var(--oglow);}

/* ===================== HERO ===================== */
.hero{min-height:100vh;display:flex;align-items:center;position:relative;overflow:hidden;padding-top:62px;}
.hero-particles{position:absolute;inset:0;pointer-events:none;}
.particle{position:absolute;width:2px;height:2px;background:var(--orange);border-radius:50%;animation:drift linear infinite;opacity:0;}
@keyframes drift{0%{opacity:0;transform:translateY(100vh) translateX(0);}10%{opacity:0.6;}90%{opacity:0.3;}100%{opacity:0;transform:translateY(-20vh) translateX(60px);}}
.hero-grid-bg{position:absolute;inset:0;background-image:linear-gradient(rgba(255,102,0,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(255,102,0,0.03) 1px,transparent 1px);background-size:50px 50px;}
.hero-glow{position:absolute;top:-20%;left:50%;transform:translateX(-50%);width:800px;height:500px;background:radial-gradient(ellipse,rgba(255,102,0,0.07) 0%,transparent 70%);pointer-events:none;}
.hero-inner{position:relative;z-index:2;max-width:1280px;margin:0 auto;padding:0 1.5rem;display:grid;grid-template-columns:1fr 1fr;gap:5rem;align-items:center;width:100%;}
.hero-left{}
.hero-badge{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,102,0,0.4);background:rgba(255,102,0,0.08);padding:5px 14px;border-radius:20px;font-size:0.78rem;color:var(--orange);font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:1.5rem;}
.hero-badge::before{content:'';width:6px;height:6px;background:var(--orange);border-radius:50%;animation:pulse 1.5s ease infinite;}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:0.5;transform:scale(1.5);}}
.hero h1{font-family:'Orbitron',monospace;font-size:3.8rem;font-weight:900;line-height:1.08;margin-bottom:1.2rem;letter-spacing:-1px;}
.hero h1 em{font-style:normal;color:var(--orange);text-shadow:0 0 40px var(--oglow);}
.hero-sub{color:var(--gray);font-size:1.05rem;line-height:1.75;max-width:460px;margin-bottom:2rem;}
.hero-actions{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:2.5rem;}
.hero-actions .btn{font-size:1rem;padding:12px 28px;border-radius:10px;}
.hero-stats{display:flex;gap:2rem;}
.stat-box{text-align:center;}
.stat-num{font-family:'Orbitron',monospace;font-size:1.8rem;font-weight:900;color:var(--orange);}
.stat-lbl{color:var(--gray);font-size:0.72rem;letter-spacing:1.5px;text-transform:uppercase;margin-top:2px;}
.hero-right{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
.hcard{background:var(--card);border:1px solid var(--border);border-radius:var(--radius2);padding:1.1rem 0.9rem;text-align:center;cursor:pointer;transition:all 0.3s;animation:floatCard 4s ease-in-out infinite;}
.hcard:nth-child(2){animation-delay:0.5s;}.hcard:nth-child(3){animation-delay:1s;}.hcard:nth-child(4){animation-delay:1.5s;}.hcard:nth-child(5){animation-delay:2s;}.hcard:nth-child(6){animation-delay:2.5s;}
@keyframes floatCard{0%,100%{transform:translateY(0);}50%{transform:translateY(-8px);}}
.hcard:hover{border-color:var(--orange);background:rgba(255,102,0,0.08);transform:translateY(-6px) scale(1.04);box-shadow:0 12px 30px var(--oglow);}
.hcard .hc-icon{font-size:2.2rem;margin-bottom:6px;display:block;}
.hcard .hc-name{font-size:0.72rem;color:var(--gray);font-weight:700;letter-spacing:0.5px;}

/* ===================== MARQUEE ===================== */
.marquee-section{background:rgba(255,102,0,0.05);border-top:1px solid var(--border);border-bottom:1px solid var(--border);padding:10px 0;overflow:hidden;}
.marquee-track{display:flex;gap:0;white-space:nowrap;animation:marqueeRun 30s linear infinite;}
.marquee-item{display:inline-flex;align-items:center;gap:8px;padding:0 2rem;color:var(--orange);font-weight:700;font-size:0.8rem;letter-spacing:1.5px;text-transform:uppercase;}
.marquee-dot{width:4px;height:4px;background:var(--orange);border-radius:50%;opacity:0.5;}
@keyframes marqueeRun{from{transform:translateX(0);}to{transform:translateX(-50%);}}

/* ===================== SECTIONS ===================== */
.section{padding:4rem 1.5rem;}
.container{max-width:1280px;margin:0 auto;}
.sec-hdr{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;}
.sec-title{font-family:'Orbitron',monospace;font-size:1.6rem;font-weight:900;white-space:nowrap;}
.sec-title span{color:var(--orange);}
.sec-line{flex:1;height:1px;background:linear-gradient(to right,var(--orange),transparent);opacity:0.4;}
.sec-count{font-size:0.8rem;color:var(--gray);font-weight:600;background:var(--card);padding:4px 12px;border-radius:20px;border:1px solid var(--border);}

/* ===================== CATEGORY FILTER ===================== */
.cats{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:2rem;}
.cat{background:var(--card);border:1px solid var(--border);color:var(--gray);padding:8px 18px;border-radius:25px;font-family:'Exo 2',sans-serif;font-weight:700;font-size:0.85rem;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:6px;}
.cat:hover{border-color:rgba(255,102,0,0.4);color:var(--white);}
.cat.active{background:var(--orange);color:#fff;border-color:var(--orange);box-shadow:0 4px 15px var(--oglow);}

/* ===================== GAME GRID ===================== */
.games-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:1.1rem;}
.gcard{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;cursor:pointer;transition:all 0.3s;position:relative;group;}
.gcard:hover{border-color:rgba(255,102,0,0.5);transform:translateY(-5px);box-shadow:0 20px 40px rgba(0,0,0,0.4),0 0 20px var(--oglow);}
.gcard-thumb{height:125px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;}
.gcard-thumb .gicon{font-size:4rem;position:relative;z-index:1;transition:transform 0.3s;filter:drop-shadow(0 4px 10px rgba(0,0,0,0.5));}
.gcard:hover .gicon{transform:scale(1.1);}
.gcard-play{position:absolute;inset:0;background:rgba(255,102,0,0.85);display:flex;align-items:center;justify-content:center;font-family:'Orbitron',monospace;font-weight:900;font-size:1rem;letter-spacing:3px;opacity:0;transition:opacity 0.2s;z-index:2;}
.gcard:hover .gcard-play{opacity:1;}
.gcard-body{padding:0.9rem 1rem;}
.gcard-name{font-weight:700;font-size:0.98rem;margin-bottom:4px;letter-spacing:0.2px;}
.gcard-meta{display:flex;align-items:center;justify-content:space-between;}
.gcard-cat{font-size:0.72rem;font-weight:700;color:var(--orange);text-transform:uppercase;letter-spacing:0.5px;}
.gcard-stars{font-size:0.72rem;color:#f59e0b;}
.gcard-badge{position:absolute;top:8px;right:8px;background:var(--orange);color:#fff;font-size:0.62rem;font-weight:900;padding:3px 9px;border-radius:20px;letter-spacing:0.5px;text-transform:uppercase;z-index:3;}
.gcard-badge.new-badge{background:#22c55e;}
.gcard-badge.hot-badge{background:var(--orange);}

/* ===================== FEATURED BANNER ===================== */
.featured-banner{background:linear-gradient(135deg,rgba(255,102,0,0.07),rgba(255,102,0,0.02));border:1px solid var(--border);border-radius:20px;padding:2.5rem;margin-bottom:3rem;position:relative;overflow:hidden;}
.featured-banner::before{content:'';position:absolute;right:-100px;top:-100px;width:400px;height:400px;background:radial-gradient(circle,rgba(255,102,0,0.08),transparent 70%);pointer-events:none;}
.featured-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-top:1.5rem;}
.fcard{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:1.2rem;display:flex;align-items:center;gap:0.9rem;cursor:pointer;transition:all 0.25s;}
.fcard:hover{background:rgba(255,102,0,0.07);border-color:rgba(255,102,0,0.3);transform:translateX(4px);}
.fcard-icon{width:52px;height:52px;border-radius:12px;background:rgba(255,102,0,0.12);display:grid;place-items:center;font-size:1.6rem;flex-shrink:0;}
.fcard-name{font-weight:700;font-size:0.95rem;margin-bottom:3px;}
.fcard-desc{color:var(--gray);font-size:0.8rem;}
.fcard-tag{display:inline-block;background:var(--orange);color:#fff;font-size:0.62rem;padding:2px 8px;border-radius:10px;font-weight:900;margin-top:5px;letter-spacing:0.5px;}

/* ===================== LEADERBOARD ===================== */
.lb-section{background:var(--dark);border-top:1px solid var(--border);}
.lb-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;}
.lb-box{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem;}
.lb-title{font-family:'Orbitron',monospace;font-size:1rem;font-weight:700;color:var(--orange);margin-bottom:1.2rem;}
.lb-row{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.04);}
.lb-row:last-child{border-bottom:none;}
.lb-rank{width:28px;font-family:'Orbitron',monospace;font-weight:900;font-size:1rem;}
.rank-1{color:#f59e0b;}.rank-2{color:#9ca3af;}.rank-3{color:#b45309;}.rank-4,.rank-5{color:var(--gray2);}
.lb-av{width:34px;height:34px;border-radius:50%;background:var(--card2);display:grid;place-items:center;font-size:1rem;flex-shrink:0;}
.lb-name{flex:1;font-weight:600;font-size:0.92rem;}
.lb-score{font-family:'Orbitron',monospace;font-weight:700;color:var(--orange);font-size:0.95rem;}

/* ===================== FOOTER ===================== */
footer{background:var(--dark);border-top:1px solid var(--border);padding:3rem 1.5rem 1.5rem;}
.footer-inner{max-width:1280px;margin:0 auto;}
.footer-top{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:2.5rem;margin-bottom:2rem;}
.footer-brand p{color:var(--gray);font-size:0.88rem;line-height:1.7;max-width:270px;margin-top:0.8rem;}
.footer-socials{display:flex;gap:8px;margin-top:1rem;}
.social-btn{width:34px;height:34px;background:var(--card2);border-radius:8px;display:grid;place-items:center;cursor:pointer;border:1px solid var(--border);transition:all 0.2s;font-size:14px;}
.social-btn:hover{background:var(--orange);border-color:var(--orange);}
.f-col h4{font-family:'Orbitron',monospace;font-size:0.85rem;font-weight:700;margin-bottom:1rem;color:var(--white);}
.f-col a{display:block;color:var(--gray);text-decoration:none;margin-bottom:8px;font-size:0.88rem;transition:color 0.2s;}
.f-col a:hover{color:var(--orange);}
.footer-bottom{border-top:1px solid rgba(255,255,255,0.05);padding-top:1.2rem;display:flex;justify-content:space-between;color:var(--gray);font-size:0.82rem;flex-wrap:wrap;gap:8px;}
.footer-bottom span{display:flex;align-items:center;gap:4px;}

/* ===================== MODAL ===================== */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.88);z-index:1000;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.25s;backdrop-filter:blur(8px);}
.modal-overlay.open{opacity:1;pointer-events:all;}
.modal{background:var(--dark);border:1px solid rgba(255,102,0,0.2);border-radius:18px;width:min(96vw,860px);max-height:93vh;display:flex;flex-direction:column;transform:scale(0.93) translateY(10px);transition:transform 0.25s;overflow:hidden;}
.modal-overlay.open .modal{transform:scale(1) translateY(0);}
.modal-head{display:flex;align-items:center;justify-content:space-between;padding:1rem 1.4rem;border-bottom:1px solid rgba(255,255,255,0.06);flex-shrink:0;}
.modal-title{font-family:'Orbitron',monospace;font-weight:900;font-size:1.1rem;display:flex;align-items:center;gap:10px;}
.modal-title-icon{font-size:1.4rem;}
.modal-close{background:rgba(255,255,255,0.07);border:none;color:var(--white);width:34px;height:34px;border-radius:8px;font-size:1.1rem;cursor:pointer;display:grid;place-items:center;transition:all 0.2s;flex-shrink:0;}
.modal-close:hover{background:var(--orange);}
.modal-body{padding:1.2rem;overflow-y:auto;flex:1;}
.modal-body::-webkit-scrollbar{width:4px;}
.modal-body::-webkit-scrollbar-thumb{background:var(--orange);}

/* ===================== GAME UI COMMONS ===================== */
.g-container{display:flex;flex-direction:column;align-items:center;gap:1rem;}
.g-scorebar{display:flex;gap:2rem;padding:0.8rem 1.5rem;background:var(--card2);border-radius:10px;border:1px solid var(--border);}
.g-score-item{text-align:center;}
.g-score-val{font-family:'Orbitron',monospace;font-size:1.6rem;font-weight:900;color:var(--orange);}
.g-score-lbl{font-size:0.65rem;color:var(--gray);letter-spacing:1.5px;text-transform:uppercase;margin-top:2px;}
.g-btn{background:linear-gradient(135deg,var(--orange),var(--orange2));color:#fff;border:none;padding:10px 28px;border-radius:9px;font-family:'Orbitron',monospace;font-weight:700;font-size:0.9rem;cursor:pointer;transition:all 0.2s;letter-spacing:1px;}
.g-btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px var(--oglow);}
.g-btn.secondary{background:var(--card2);border:1px solid var(--border);color:var(--gray);}
.g-btn.secondary:hover{border-color:var(--orange);color:var(--white);}
.g-hint{color:var(--gray);font-size:0.82rem;text-align:center;padding:4px 0;}
.g-canvas{border-radius:10px;border:1px solid var(--border);display:block;max-width:100%;touch-action:none;}
.g-status{font-family:'Orbitron',monospace;font-weight:700;font-size:1.1rem;text-align:center;padding:6px;}

/* ===================== GAME-SPECIFIC ===================== */
/* Tic Tac Toe */
.ttt-board{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;width:280px;}
.ttt-cell{background:var(--card2);border:2px solid rgba(255,255,255,0.06);border-radius:10px;height:88px;display:flex;align-items:center;justify-content:center;font-size:2.5rem;cursor:pointer;transition:all 0.2s;font-family:'Orbitron',monospace;font-weight:900;}
.ttt-cell:hover:not(.taken){border-color:rgba(255,102,0,0.5);background:rgba(255,102,0,0.05);}
.ttt-cell.X{color:var(--orange);}
.ttt-cell.O{color:#60a5fa;}
.ttt-cell.win-cell{border-color:var(--orange);background:rgba(255,102,0,0.15);animation:winPulse 0.5s ease;}
@keyframes winPulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}

/* Sudoku */
.sdk-wrap{overflow-x:auto;max-width:100%;}
.sdk-grid{border-collapse:collapse;border:2px solid var(--orange);border-radius:4px;}
.sdk-cell{width:38px;height:38px;text-align:center;font-weight:700;font-size:0.95rem;cursor:pointer;background:var(--card2);color:var(--white);border:1px solid rgba(255,255,255,0.06);transition:background 0.1s;user-select:none;}
.sdk-cell.given{color:var(--orange);cursor:default;}
.sdk-cell.selected{background:rgba(255,102,0,0.2);}
.sdk-cell.err{color:#ef4444;}
.sdk-cell.highlight{background:rgba(255,102,0,0.07);}
.sdk-nums{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;}
.sdk-num{background:var(--card2);border:1px solid var(--border);color:var(--white);width:38px;height:38px;border-radius:8px;font-weight:700;font-size:1rem;cursor:pointer;font-family:'Exo 2',sans-serif;transition:all 0.15s;}
.sdk-num:hover{background:var(--orange);border-color:var(--orange);}

/* Candy Crush */
.cc-board{display:grid;gap:5px;}
.cc-cell{width:50px;height:50px;border-radius:10px;cursor:pointer;transition:all 0.15s;display:flex;align-items:center;justify-content:center;font-size:1.5rem;border:2px solid transparent;user-select:none;}
.cc-cell:hover{transform:scale(1.08);}
.cc-cell.selected{border-color:#fff;box-shadow:0 0 12px rgba(255,255,255,0.4);transform:scale(1.1);}
.cc-cell.matched{animation:matchPop 0.3s ease forwards;}
@keyframes matchPop{0%{transform:scale(1);}50%{transform:scale(1.3);}100%{opacity:0;transform:scale(0);}}

/* Memory Card */
.mem-grid{display:grid;gap:8px;}
.mem-card{height:75px;border-radius:10px;border:2px solid var(--border);background:var(--card2);cursor:pointer;transition:all 0.35s;transform-style:preserve-3d;font-size:0;display:flex;align-items:center;justify-content:center;}
.mem-card.flipped,.mem-card.matched{font-size:2rem;background:rgba(255,102,0,0.1);border-color:var(--orange);}
.mem-card.matched{background:rgba(34,197,94,0.1);border-color:#22c55e;}

/* Not a Robot */
.robot-panel{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:2rem;max-width:380px;width:100%;}
.robot-checkbox-row{display:flex;align-items:center;gap:12px;padding:1rem;background:var(--card2);border-radius:8px;cursor:pointer;margin-bottom:1rem;border:1px solid var(--border);transition:border-color 0.2s;}
.robot-checkbox-row:hover{border-color:var(--orange);}
.robot-cb{width:22px;height:22px;accent-color:var(--orange);cursor:pointer;}
.captcha-display{font-family:monospace;font-size:2rem;letter-spacing:10px;text-align:center;background:rgba(0,0,0,0.4);padding:1rem;border-radius:8px;margin-bottom:1rem;user-select:none;filter:url(#warp);}
.captcha-in{width:100%;padding:10px 14px;background:var(--card2);border:1px solid var(--border);color:var(--white);border-radius:8px;font-size:1rem;font-family:'Exo 2',sans-serif;margin-bottom:0.8rem;}
.captcha-in:focus{outline:none;border-color:var(--orange);}

/* ===================== NOTIFICATION ===================== */
.toast{position:fixed;top:76px;right:16px;background:linear-gradient(135deg,var(--orange),var(--orange2));color:#fff;padding:10px 20px;border-radius:10px;font-weight:700;z-index:2000;transform:translateX(150%);transition:transform 0.3s;font-size:0.92rem;box-shadow:0 6px 20px var(--oglow);max-width:280px;}
.toast.show{transform:translateX(0);}

/* ===================== RESPONSIVE ===================== */
@media(max-width:1024px){.featured-grid{grid-template-columns:1fr 1fr;}.footer-top{grid-template-columns:1fr 1fr;}}
@media(max-width:768px){
  nav{display:none;}
  .search-wrap{display:none;}
  .hero-inner{grid-template-columns:1fr;gap:2rem;text-align:center;}
  .hero h1{font-size:2.5rem;}
  .hero-right{display:none;}
  .hero-stats{justify-content:center;}
  .featured-grid{grid-template-columns:1fr;}
  .lb-grid{grid-template-columns:1fr;}
  .footer-top{grid-template-columns:1fr;}
  .g-scorebar{gap:1rem;}
  .g-score-val{font-size:1.2rem;}
}
</style>
</head>
<body>

<!-- ============ TOAST ============ -->
<div class="toast" id="toast"></div>

<!-- ============ HEADER ============ -->
<header>
  <div class="hdr">
    <a class="logo" href="#">
      <div class="logo-box">üéÆ</div>
      <div class="logo-text">Game<span>Flow</span></div>
    </a>
    <nav>
      <a href="#" class="active" onclick="scrollTo(0,0);return false;">Home</a>
      <a href="#games-section">All Games</a>
      <a href="#leaderboard">Leaderboard</a>
    </nav>
    <div class="hdr-right">
      <div class="search-wrap">
        <span class="search-icon">üîç</span>
        <input type="text" placeholder="Search games..." id="searchInput" oninput="searchGames(this.value)">
      </div>
      <button class="btn btn-ghost" onclick="showToast('Sign in coming soon!')">Sign In</button>
      <button class="btn btn-fill" onclick="showToast('Welcome to GameFlow! üéÆ')">Play Free</button>
    </div>
  </div>
</header>

<!-- ============ HERO ============ -->
<section class="hero" id="home">
  <div class="hero-particles" id="particles"></div>
  <div class="hero-grid-bg"></div>
  <div class="hero-glow"></div>
  <div class="hero-inner">
    <div class="hero-left">
      <div class="hero-badge">üî• 15+ Games Available Now</div>
      <h1>The Ultimate<br>Browser <em>Gaming</em><br>Experience</h1>
      <p class="hero-sub">GameFlow brings you 15+ fully playable games ‚Äî from strategy puzzles to high-speed racing. No downloads, no logins needed. Just pure fun.</p>
      <div class="hero-actions">
        <button class="btn btn-fill" onclick="document.getElementById('games-section').scrollIntoView({behavior:'smooth'})">üïπÔ∏è Play Now ‚Äî It's Free</button>
        <button class="btn btn-ghost" onclick="document.getElementById('games-section').scrollIntoView({behavior:'smooth'})">Browse Games</button>
      </div>
      <div class="hero-stats">
        <div class="stat-box"><div class="stat-num">15+</div><div class="stat-lbl">Games</div></div>
        <div class="stat-box"><div class="stat-num">100%</div><div class="stat-lbl">Free</div></div>
        <div class="stat-box"><div class="stat-num">4.9‚òÖ</div><div class="stat-lbl">Rating</div></div>
        <div class="stat-box"><div class="stat-num">50K+</div><div class="stat-lbl">Players</div></div>
      </div>
    </div>
    <div class="hero-right">
      <div class="hcard" onclick="openGame('tictactoe')"><span class="hc-icon">‚≠ï</span><div class="hc-name">Tic Tac Toe</div></div>
      <div class="hcard" onclick="openGame('sudoku')"><span class="hc-icon">üî¢</span><div class="hc-name">Sudoku</div></div>
      <div class="hcard" onclick="openGame('carracing')"><span class="hc-icon">üèéÔ∏è</span><div class="hc-name">Car Racing</div></div>
      <div class="hcard" onclick="openGame('candycrush')"><span class="hc-icon">üç¨</span><div class="hc-name">Candy Crush</div></div>
      <div class="hcard" onclick="openGame('tetris')"><span class="hc-icon">üì¶</span><div class="hc-name">Box Fill</div></div>
      <div class="hcard" onclick="openGame('bubble')"><span class="hc-icon">ü´ß</span><div class="hc-name">Bubble Shooter</div></div>
    </div>
  </div>
</section>

<!-- ============ MARQUEE ============ -->
<div class="marquee-section">
  <div class="marquee-track" id="marqueeTrack"></div>
</div>

<!-- ============ FEATURED ============ -->
<section class="section" style="padding-bottom:0;">
  <div class="container">
    <div class="featured-banner">
      <div class="sec-hdr" style="margin-bottom:0;">
        <div class="sec-title">‚≠ê Featured <span>Games</span></div>
      </div>
      <div class="featured-grid" id="featuredGrid"></div>
    </div>
  </div>
</section>

<!-- ============ ALL GAMES ============ -->
<section class="section" id="games-section">
  <div class="container">
    <div class="sec-hdr">
      <div class="sec-title">All <span>Games</span></div>
      <div class="sec-line"></div>
      <div class="sec-count" id="gameCount">16 Games</div>
    </div>
    <div class="cats" id="catFilter"></div>
    <div class="games-grid" id="gamesGrid"></div>
  </div>
</section>

<!-- ============ LEADERBOARD ============ -->
<section class="section lb-section" id="leaderboard">
  <div class="container">
    <div class="sec-hdr">
      <div class="sec-title">üèÜ Leader<span>board</span></div>
      <div class="sec-line"></div>
    </div>
    <div class="lb-grid">
      <div class="lb-box">
        <div class="lb-title">üèéÔ∏è Car Racing ‚Äî Top Racers</div>
        <div class="lb-row"><div class="lb-rank rank-1">1</div><div class="lb-av">üëë</div><div class="lb-name">SpeedKing99</div><div class="lb-score">124,500</div></div>
        <div class="lb-row"><div class="lb-rank rank-2">2</div><div class="lb-av">ü•à</div><div class="lb-name">TurboRacer</div><div class="lb-score">98,320</div></div>
        <div class="lb-row"><div class="lb-rank rank-3">3</div><div class="lb-av">ü•â</div><div class="lb-name">NightDrift</div><div class="lb-score">87,650</div></div>
        <div class="lb-row"><div class="lb-rank rank-4">4</div><div class="lb-av">üéÆ</div><div class="lb-name">FastFury</div><div class="lb-score">72,100</div></div>
        <div class="lb-row"><div class="lb-rank rank-5">5</div><div class="lb-av">‚ö°</div><div class="lb-name">BlazeX</div><div class="lb-score">65,800</div></div>
      </div>
      <div class="lb-box">
        <div class="lb-title">üì¶ Tetris ‚Äî Box Champions</div>
        <div class="lb-row"><div class="lb-rank rank-1">1</div><div class="lb-av">üëë</div><div class="lb-name">BlockMaster</div><div class="lb-score">890,000</div></div>
        <div class="lb-row"><div class="lb-rank rank-2">2</div><div class="lb-av">ü•à</div><div class="lb-name">TetrisGod</div><div class="lb-score">756,400</div></div>
        <div class="lb-row"><div class="lb-rank rank-3">3</div><div class="lb-av">ü•â</div><div class="lb-name">DropZone</div><div class="lb-score">634,200</div></div>
        <div class="lb-row"><div class="lb-rank rank-4">4</div><div class="lb-av">üéÆ</div><div class="lb-name">ClearLine</div><div class="lb-score">521,800</div></div>
        <div class="lb-row"><div class="lb-rank rank-5">5</div><div class="lb-av">‚ö°</div><div class="lb-name">PieceByPiece</div><div class="lb-score">480,000</div></div>
      </div>
    </div>
  </div>
</section>

<!-- ============ FOOTER ============ -->
<footer>
  <div class="footer-inner">
    <div class="footer-top">
      <div class="footer-brand">
        <div class="logo"><div class="logo-box">üéÆ</div><div class="logo-text">Game<span>Flow</span></div></div>
        <p>Your #1 destination for free browser games. 15+ games, zero downloads. Play anytime, anywhere, on any device.</p>
        <div class="footer-socials">
          <div class="social-btn" title="Facebook">üìò</div>
          <div class="social-btn" title="Twitter">üê¶</div>
          <div class="social-btn" title="Instagram">üì∏</div>
          <div class="social-btn" title="YouTube">‚ñ∂Ô∏è</div>
        </div>
      </div>
      <div class="f-col">
        <h4>Top Games</h4>
        <a href="#" onclick="openGame('carracing');return false;">Car Racing</a>
        <a href="#" onclick="openGame('tetris');return false;">Box Fill</a>
        <a href="#" onclick="openGame('bubble');return false;">Bubble Shooter</a>
        <a href="#" onclick="openGame('gunfight');return false;">Gun Fight</a>
        <a href="#" onclick="openGame('stickman');return false;">Stickman Run</a>
      </div>
      <div class="f-col">
        <h4>Puzzle Games</h4>
        <a href="#" onclick="openGame('tictactoe');return false;">Tic Tac Toe</a>
        <a href="#" onclick="openGame('sudoku');return false;">Sudoku</a>
        <a href="#" onclick="openGame('memory');return false;">Memory Cards</a>
        <a href="#" onclick="openGame('candycrush');return false;">Candy Crush</a>
        <a href="#" onclick="openGame('notarobot');return false;">Not A Robot</a>
      </div>
      <div class="f-col">
        <h4>Company</h4>
        <a href="#">About Us</a>
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Use</a>
        <a href="#">Advertise</a>
        <a href="#">Contact</a>
      </div>
    </div>
    <div class="footer-bottom">
      <span>¬© 2024 GameFlow. All rights reserved.</span>
      <span>Made with ‚ù§Ô∏è for gamers worldwide</span>
    </div>
  </div>
</footer>

<!-- ============ MODAL ============ -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title"><span class="modal-title-icon" id="mIcon">üéÆ</span><span id="mTitle">Game</span></div>
      <button class="modal-close" id="modalCloseBtn">‚úï</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<script>
"use strict";
/* =========================================================
   GAME REGISTRY
========================================================= */
const GAMES = [
  {id:'tictactoe', name:'Tic Tac Toe',   icon:'‚≠ï', cat:'puzzle', bg:'linear-gradient(135deg,#1a1a3e,#0e0e2e)', rating:'4.8', badge:'classic', featured:true,  desc:'Beat the AI in classic Tic Tac Toe'},
  {id:'sudoku',    name:'Sudoku',          icon:'üî¢', cat:'puzzle', bg:'linear-gradient(135deg,#0e2e0e,#0a1e0a)', rating:'4.9', badge:'brain',   featured:false, desc:'Fill the 9√ó9 grid ‚Äî no repeats!'},
  {id:'candycrush',name:'Candy Crush',     icon:'üç¨', cat:'arcade', bg:'linear-gradient(135deg,#2e0e2e,#1e0a1e)', rating:'4.7', badge:'sweet',   featured:true,  desc:'Match 3 candies to crush them'},
  {id:'bubble',    name:'Bubble Shooter',  icon:'ü´ß', cat:'arcade', bg:'linear-gradient(135deg,#0e0e3e,#080820)', rating:'4.6', badge:'fun',     featured:false, desc:'Aim & shoot to pop bubbles'},
  {id:'carracing', name:'Car Racing',      icon:'üèéÔ∏è', cat:'racing', bg:'linear-gradient(135deg,#2e1000,#3d1500)', rating:'4.9', badge:'hot',     featured:true,  desc:'Dodge traffic at top speed'},
  {id:'gunfight',  name:'Gun Fight',       icon:'üî´', cat:'action', bg:'linear-gradient(135deg,#2e0000,#3d0000)', rating:'4.8', badge:'action',  featured:true,  desc:'Shoot enemies before they reach you'},
  {id:'arrowbow',  name:'Arrow & Bow',     icon:'üèπ', cat:'action', bg:'linear-gradient(135deg,#0e2000,#162d00)', rating:'4.5', badge:'aim',     featured:false, desc:'Hit moving targets with arrows'},
  {id:'hillclimb', name:'Hill Climb',      icon:'üèîÔ∏è', cat:'racing', bg:'linear-gradient(135deg,#000a2e,#001040)', rating:'4.6', badge:'drive',   featured:false, desc:'Conquer hills without flipping'},
  {id:'templerun', name:'Temple Run',      icon:'üèõÔ∏è', cat:'arcade', bg:'linear-gradient(135deg,#2a1500,#3d2000)', rating:'4.7', badge:'run',     featured:false, desc:'Run, jump & slide to survive'},
  {id:'tetris',    name:'Box Fill',        icon:'üì¶', cat:'puzzle', bg:'linear-gradient(135deg,#00002e,#00003d)', rating:'4.8', badge:'classic', featured:true,  desc:'Classic Tetris ‚Äî drop & clear lines'},
  {id:'glasshit',  name:'Glass Hit',       icon:'ü™ü', cat:'casual', bg:'linear-gradient(135deg,#0a2030,#0f2a3a)', rating:'4.4', badge:'smash',   featured:false, desc:'Smash glowing glass targets'},
  {id:'notarobot', name:'Not A Robot',     icon:'ü§ñ', cat:'casual', bg:'linear-gradient(135deg,#1e1000,#2e1800)', rating:'4.3', badge:'tricky',  featured:false, desc:'Prove you\'re human ‚Äî pass the test'},
  {id:'bikeracing',name:'Bike Racing',     icon:'üèçÔ∏è', cat:'racing', bg:'linear-gradient(135deg,#1a002e,#220040)', rating:'4.7', badge:'speed',   featured:false, desc:'Weave through traffic on your bike'},
  {id:'stickman',  name:'Stickman Run',    icon:'üèÉ', cat:'arcade', bg:'linear-gradient(135deg,#002e10,#003d15)', rating:'4.5', badge:'runner',  featured:false, desc:'Jump over obstacles endlessly'},
  {id:'spaceship', name:'Space Blaster',   icon:'üöÄ', cat:'action', bg:'linear-gradient(135deg,#000020,#00003a)', rating:'4.6', badge:'new',     featured:false, desc:'Blast alien invaders from space'},
  {id:'memory',    name:'Memory Cards',    icon:'üÉè', cat:'puzzle', bg:'linear-gradient(135deg,#200020,#2e002e)', rating:'4.5', badge:'memory',  featured:false, desc:'Match pairs before time runs out'},
];

const CATEGORIES = [
  {id:'all',    label:'üéÆ All Games'},
  {id:'puzzle', label:'üß© Puzzle'},
  {id:'action', label:'üí• Action'},
  {id:'racing', label:'üèéÔ∏è Racing'},
  {id:'arcade', label:'üïπÔ∏è Arcade'},
  {id:'casual', label:'‚òÄÔ∏è Casual'},
];

/* =========================================================
   GAME ENGINE HELPERS ‚Äî proper lifecycle management
========================================================= */
let activeRAF = null;
let activeIntervals = [];
let activeListeners = []; // {el, type, fn, options}
let activeGame = null;

function stopEngine() {
  if (activeRAF) { cancelAnimationFrame(activeRAF); activeRAF = null; }
  activeIntervals.forEach(id => clearInterval(id));
  activeIntervals = [];
  activeListeners.forEach(({el, type, fn, opts}) => el.removeEventListener(type, fn, opts));
  activeListeners = [];
}

function addListener(el, type, fn, opts) {
  el.addEventListener(type, fn, opts);
  activeListeners.push({el, type, fn, opts});
}

function addInterval(fn, ms) {
  const id = setInterval(fn, ms);
  activeIntervals.push(id);
  return id;
}

function startLoop(fn) {
  function tick() { fn(); activeRAF = requestAnimationFrame(tick); }
  activeRAF = requestAnimationFrame(tick);
}

/* =========================================================
   UI HELPERS
========================================================= */
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

/* =========================================================
   MODAL SYSTEM
========================================================= */
const overlay = document.getElementById('modalOverlay');
overlay.addEventListener('click', e => { if (e.target === overlay) closeModal(); });
document.getElementById('modalCloseBtn').addEventListener('click', closeModal);
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

function openGame(id) {
  const game = GAMES.find(g => g.id === id);
  if (!game) return;
  stopEngine();
  document.getElementById('mIcon').textContent = game.icon;
  document.getElementById('mTitle').textContent = game.name;
  const body = document.getElementById('modalBody');
  body.innerHTML = '<div class="g-container" id="gc"></div>';
  overlay.classList.add('open');
  document.body.style.overflow = 'hidden';
  const gc = document.getElementById('gc');
  const builders = {
    tictactoe: buildTTT, sudoku: buildSudoku, candycrush: buildCandy,
    bubble: buildBubble, carracing: buildCarRace, gunfight: buildGunFight,
    arrowbow: buildArrowBow, hillclimb: buildHillClimb, templerun: buildTempleRun,
    tetris: buildTetris, glasshit: buildGlassHit, notarobot: buildNotARobot,
    bikeracing: buildBikeRace, stickman: buildStickman, spaceship: buildSpaceship,
    memory: buildMemory,
  };
  if (builders[id]) builders[id](gc);
}

function closeModal() {
  stopEngine();
  overlay.classList.remove('open');
  document.body.style.overflow = '';
  document.getElementById('modalBody').innerHTML = '';
}

/* =========================================================
   RENDER GRID
========================================================= */
let currentCat = 'all';

function renderGrid(filter = 'all', search = '') {
  const grid = document.getElementById('gamesGrid');
  const filtered = GAMES.filter(g => {
    const catOk = filter === 'all' || g.cat === filter;
    const searchOk = !search || g.name.toLowerCase().includes(search.toLowerCase());
    return catOk && searchOk;
  });
  document.getElementById('gameCount').textContent = filtered.length + ' Games';
  grid.innerHTML = filtered.map(g => `
    <div class="gcard" onclick="openGame('${g.id}')">
      ${g.badge ? `<div class="gcard-badge ${g.badge==='new'?'new-badge':'hot-badge'}">${g.badge}</div>` : ''}
      <div class="gcard-thumb" style="background:${g.bg}">
        <span class="gicon">${g.icon}</span>
        <div class="gcard-play">‚ñ∂ PLAY</div>
      </div>
      <div class="gcard-body">
        <div class="gcard-name">${g.name}</div>
        <div class="gcard-meta">
          <span class="gcard-cat">${g.cat}</span>
          <span class="gcard-stars">${'‚òÖ'.repeat(Math.floor(parseFloat(g.rating)))} ${g.rating}</span>
        </div>
      </div>
    </div>
  `).join('');
}

function filterCat(cat, btn) {
  currentCat = cat;
  document.querySelectorAll('.cat').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderGrid(cat, document.getElementById('searchInput').value);
}

function searchGames(val) {
  renderGrid(currentCat, val);
}

/* =========================================================
   INIT CATEGORIES & FEATURED
========================================================= */
function initUI() {
  // Categories
  const catEl = document.getElementById('catFilter');
  catEl.innerHTML = CATEGORIES.map((c,i) => 
    `<button class="cat${i===0?' active':''}" onclick="filterCat('${c.id}',this)">${c.label}</button>`
  ).join('');

  // Featured
  const featured = GAMES.filter(g => g.featured);
  document.getElementById('featuredGrid').innerHTML = featured.map(g => `
    <div class="fcard" onclick="openGame('${g.id}')">
      <div class="fcard-icon">${g.icon}</div>
      <div>
        <div class="fcard-name">${g.name}</div>
        <div class="fcard-desc">${g.desc}</div>
        <span class="fcard-tag">${g.badge.toUpperCase()}</span>
      </div>
    </div>
  `).join('');

  // Marquee
  const items = GAMES.map(g => `<span class="marquee-item">${g.icon} ${g.name} <span class="marquee-dot"></span></span>`).join('');
  const track = document.getElementById('marqueeTrack');
  track.innerHTML = items + items; // duplicate for seamless loop

  // Particles
  const pc = document.getElementById('particles');
  for (let i = 0; i < 20; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.cssText = `left:${Math.random()*100}%;animation-duration:${8+Math.random()*12}s;animation-delay:${Math.random()*10}s;`;
    pc.appendChild(p);
  }

  renderGrid();
}
initUI();

/* ==============================================================
   GAME 1: TIC TAC TOE ‚Äî Human vs AI (Minimax)
============================================================== */
function buildTTT(c) {
  let board = Array(9).fill('');
  let scores = {X:0, O:0, D:0};
  let gameOver = false;

  c.innerHTML = `
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="tX">0</div><div class="g-score-lbl">You (X)</div></div>
      <div class="g-score-item"><div class="g-score-val" id="tD">0</div><div class="g-score-lbl">Draw</div></div>
      <div class="g-score-item"><div class="g-score-val" id="tO">0</div><div class="g-score-lbl">CPU (O)</div></div>
    </div>
    <div class="g-status" id="tStatus">Your turn ‚Äî click a cell!</div>
    <div class="ttt-board" id="tBoard"></div>
    <button class="g-btn" onclick="tttReset()">New Game</button>
  `;

  function renderBoard() {
    document.getElementById('tBoard').innerHTML = board.map((v,i) =>
      `<div class="ttt-cell${v?' taken '+v:''}" id="tc${i}" onclick="tttClick(${i})">${v}</div>`
    ).join('');
  }

  const WINS = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

  function checkWin(b, p) {
    return WINS.find(w => w.every(i => b[i] === p)) || null;
  }

  function minimax(b, depth, isMax, alpha, beta) {
    const xWin = checkWin(b,'X'), oWin = checkWin(b,'O');
    if (oWin) return 10 - depth;
    if (xWin) return depth - 10;
    const empty = b.map((v,i)=>v?null:i).filter(v=>v!==null);
    if (!empty.length) return 0;

    if (isMax) {
      let best = -Infinity;
      for (let i of empty) {
        b[i] = 'O';
        best = Math.max(best, minimax(b, depth+1, false, alpha, beta));
        b[i] = '';
        alpha = Math.max(alpha, best);
        if (beta <= alpha) break;
      }
      return best;
    } else {
      let best = Infinity;
      for (let i of empty) {
        b[i] = 'X';
        best = Math.min(best, minimax(b, depth+1, true, alpha, beta));
        b[i] = '';
        beta = Math.min(beta, best);
        if (beta <= alpha) break;
      }
      return best;
    }
  }

  function cpuMove() {
    const empty = board.map((v,i)=>v?null:i).filter(v=>v!==null);
    if (!empty.length) return;
    let best = -Infinity, move = empty[0];
    for (let i of empty) {
      board[i] = 'O';
      const val = minimax(board, 0, false, -Infinity, Infinity);
      board[i] = '';
      if (val > best) { best = val; move = i; }
    }
    board[move] = 'O';
    renderBoard();
    const w = checkWin(board,'O');
    if (w) { highlightWin(w); scores.O++; updateScores(); setStatus('ü§ñ CPU Wins!'); gameOver=true; return; }
    if (board.every(Boolean)) { scores.D++; updateScores(); setStatus('ü§ù Draw!'); gameOver=true; return; }
    setStatus('Your turn ‚Äî click a cell!');
  }

  function highlightWin(w) {
    w.forEach(i => {
      const cell = document.getElementById('tc'+i);
      if (cell) cell.classList.add('win-cell');
    });
  }

  function setStatus(msg) { const el = document.getElementById('tStatus'); if(el) el.textContent = msg; }
  function updateScores() {
    ['X','O','D'].forEach(k => { const el = document.getElementById('t'+k); if(el) el.textContent = scores[k]; });
  }

  window.tttClick = function(i) {
    if (gameOver || board[i]) return;
    board[i] = 'X';
    renderBoard();
    const w = checkWin(board,'X');
    if (w) { highlightWin(w); scores.X++; updateScores(); setStatus('üéâ You Win!'); gameOver=true; return; }
    if (board.every(Boolean)) { scores.D++; updateScores(); setStatus('ü§ù Draw!'); gameOver=true; return; }
    setStatus('CPU thinking...');
    setTimeout(cpuMove, 400);
  };

  window.tttReset = function() {
    board = Array(9).fill('');
    gameOver = false;
    renderBoard();
    setStatus('Your turn ‚Äî click a cell!');
  };

  renderBoard();
}

/* ==============================================================
   GAME 2: SUDOKU
============================================================== */
function buildSudoku(c) {
  // Full valid puzzle + solution
  const puzStr = '530070000600195000098000060800060003400803001700020006060000280000419005000080079';
  const solStr = '534678912672195348198342567859761423426853791713924856961537284287419635345286179';
  const puzzle = puzStr.split('').map(Number);
  const solution = solStr.split('').map(Number);
  let userBoard = [...puzzle];
  let selected = null;
  let errors = 0;

  c.innerHTML = `
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="sdkErr">0</div><div class="g-score-lbl">Errors</div></div>
      <div class="g-score-item"><div class="g-score-val" id="sdkLeft">51</div><div class="g-score-lbl">Empty</div></div>
    </div>
    <div class="sdk-wrap"><table class="sdk-grid" id="sdkTable" cellspacing="0" cellpadding="0"></table></div>
    <div class="sdk-nums" id="sdkNumpad"></div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
      <button class="g-btn" onclick="sdkNewGame()">New Game</button>
      <button class="g-btn secondary" onclick="sdkSolve()">Solve</button>
    </div>
    <div class="g-hint">Click a cell, then click a number. Keyboard also works!</div>
  `;

  // Build numpad
  const np = document.getElementById('sdkNumpad');
  for (let n = 1; n <= 9; n++) {
    const btn = document.createElement('button');
    btn.className = 'sdk-num';
    btn.textContent = n;
    btn.addEventListener('click', () => sdkEnter(n));
    np.appendChild(btn);
  }
  const clr = document.createElement('button');
  clr.className = 'sdk-num';
  clr.textContent = '‚úï';
  clr.style.color = '#ef4444';
  clr.addEventListener('click', () => sdkEnter(0));
  np.appendChild(clr);

  function renderTable() {
    const tbl = document.getElementById('sdkTable');
    if (!tbl) return;
    let html = '';
    for (let r = 0; r < 9; r++) {
      const borderBottom = (r === 2 || r === 5) ? 'border-bottom:2px solid rgba(255,102,0,0.6)' : '';
      html += `<tr style="${borderBottom}">`;
      for (let col = 0; col < 9; col++) {
        const idx = r * 9 + col;
        const given = puzzle[idx] !== 0;
        const val = userBoard[idx] || '';
        const isErr = !given && val && val !== solution[idx];
        const isSel = selected === idx;
        const borderRight = (col === 2 || col === 5) ? 'border-right:2px solid rgba(255,102,0,0.6)' : '';
        let cls = 'sdk-cell';
        if (given) cls += ' given';
        if (isSel) cls += ' selected';
        if (isErr) cls += ' err';
        html += `<td class="${cls}" style="${borderRight}" onclick="sdkSelect(${idx})">${val}</td>`;
      }
      html += '</tr>';
    }
    tbl.innerHTML = html;
    const left = userBoard.filter((v,i) => !v && !puzzle[i]).length;
    const el = document.getElementById('sdkLeft');
    if (el) el.textContent = Math.max(0, left);
  }

  window.sdkSelect = function(idx) {
    if (puzzle[idx] !== 0) { selected = null; renderTable(); return; }
    selected = idx;
    renderTable();
  };

  window.sdkEnter = function(num) {
    if (selected === null || puzzle[selected] !== 0) return;
    userBoard[selected] = num || null;
    if (num && num !== solution[selected]) {
      errors++;
      const el = document.getElementById('sdkErr');
      if (el) el.textContent = errors;
    }
    const left = userBoard.filter((v,i) => puzzle[i]===0 && !v).length;
    if (left === 0 && userBoard.every((v,i) => !v || v === solution[i])) {
      showToast('üéâ Sudoku Solved! Brilliant!');
    }
    renderTable();
  };

  window.sdkSolve = function() { userBoard = [...solution]; renderTable(); showToast('Puzzle solved!'); };
  window.sdkNewGame = function() {
    userBoard = [...puzzle]; errors = 0; selected = null;
    const e1 = document.getElementById('sdkErr'); if(e1) e1.textContent = 0;
    renderTable();
  };

  const keyFn = function(e) {
    if (e.key >= '1' && e.key <= '9') sdkEnter(parseInt(e.key));
    else if (e.key === 'Backspace' || e.key === 'Delete' || e.key === '0') sdkEnter(0);
  };
  addListener(document, 'keydown', keyFn);
  renderTable();
}

/* ==============================================================
   GAME 3: CANDY CRUSH
============================================================== */
function buildCandy(c) {
  const COLS = 8, CANDIES = ['üç¨','üç≠','üç´','üçä','üçá','‚≠ê','üçì'];
  let board = [], score = 0, moves = 25, selected = null, busy = false;

  function newBoard() {
    board = [];
    for (let r = 0; r < COLS; r++) {
      board.push([]);
      for (let col = 0; col < COLS; col++) board[r].push(randomCandy());
    }
    // Remove initial matches
    let changed = true;
    while (changed) { changed = false; if (findMatches().length) { resolveOnce(); changed = true; } }
  }

  function randomCandy() { return Math.floor(Math.random() * CANDIES.length); }

  c.innerHTML = `
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="ccScore">0</div><div class="g-score-lbl">Score</div></div>
      <div class="g-score-item"><div class="g-score-val" id="ccMoves">25</div><div class="g-score-lbl">Moves</div></div>
    </div>
    <div class="cc-board" id="ccBoard" style="grid-template-columns:repeat(${COLS},50px);"></div>
    <div class="g-hint">Click two adjacent candies to swap them!</div>
    <button class="g-btn" onclick="ccReset()">New Game</button>
  `;

  function render() {
    const el = document.getElementById('ccBoard');
    if (!el) return;
    el.innerHTML = '';
    for (let r = 0; r < COLS; r++) {
      for (let col = 0; col < COLS; col++) {
        const div = document.createElement('div');
        div.className = 'cc-cell' + (selected && selected[0]===r&&selected[1]===col ? ' selected' : '');
        div.style.background = `hsl(${board[r][col]*50},65%,35%)`;
        div.textContent = CANDIES[board[r][col]];
        div.addEventListener('click', () => ccClick(r, col));
        el.appendChild(div);
      }
    }
  }

  function findMatches() {
    const matched = new Set();
    // Horizontal
    for (let r = 0; r < COLS; r++)
      for (let col = 0; col < COLS-2; col++)
        if (board[r][col]===board[r][col+1]&&board[r][col]===board[r][col+2])
          [0,1,2].forEach(k => matched.add(r+','+String(col+k)));
    // Vertical
    for (let r = 0; r < COLS-2; r++)
      for (let col = 0; col < COLS; col++)
        if (board[r][col]===board[r+1][col]&&board[r][col]===board[r+2][col])
          [0,1,2].forEach(k => matched.add(String(r+k)+','+col));
    return [...matched];
  }

  function resolveOnce() {
    findMatches().forEach(k => {
      const [r,col] = k.split(',').map(Number);
      board[r][col] = -1;
    });
    // Drop
    for (let col = 0; col < COLS; col++) {
      let empties = [];
      for (let r = COLS-1; r >= 0; r--) { if (board[r][col]===-1) empties.push(r); }
      for (let r of empties) { for (let rr=r;rr>0;rr--) board[rr][col]=board[rr-1][col]; board[0][col]=randomCandy(); }
    }
  }

  function ccClick(r, col) {
    if (busy || moves <= 0) return;
    if (!selected) { selected = [r,col]; render(); return; }
    const [sr,sc] = selected;
    if (r===sr&&col===sc) { selected=null; render(); return; }
    const adj = Math.abs(r-sr)+Math.abs(col-sc)===1;
    if (!adj) { selected=[r,col]; render(); return; }
    // swap
    [board[r][col],board[sr][sc]] = [board[sr][sc],board[r][col]];
    const m = findMatches();
    if (m.length) {
      moves--;
      const scEl = document.getElementById('ccMoves'); if(scEl) scEl.textContent=moves;
      busy=true; selected=null;
      cascade();
      if (moves <= 0) setTimeout(() => showToast('No moves left! Score: '+score), 500);
    } else {
      [board[r][col],board[sr][sc]] = [board[sr][sc],board[r][col]]; // undo
      showToast('No match! Try another swap');
      selected=null;
    }
    render();
  }

  function cascade() {
    const m = findMatches();
    if (!m.length) { busy=false; render(); return; }
    score += m.length * 10;
    const el = document.getElementById('ccScore'); if(el) el.textContent=score;
    resolveOnce();
    render();
    setTimeout(cascade, 250);
  }

  window.ccReset = function() {
    score=0;moves=25;selected=null;busy=false;
    const s=document.getElementById('ccScore'); if(s)s.textContent=0;
    const m=document.getElementById('ccMoves'); if(m)m.textContent=25;
    newBoard(); render();
  };

  newBoard();
  render();
}

/* ==============================================================
   GAME 4: BUBBLE SHOOTER
============================================================== */
function buildBubble(c) {
  const W = 460, H = 480, R = 20, COLS = 11;
  const COLORS = ['#ff6600','#3b82f6','#22c55e','#ec4899','#f59e0b','#8b5cf6'];
  let grid = [], bullet = null, nextColor = randColor(), shooting = false;
  let score = 0, mouseAngle = -Math.PI/2;

  c.innerHTML = `
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="bScore">0</div><div class="g-score-lbl">Score</div></div>
      <div class="g-score-item"><div class="g-score-val" id="bLeft">0</div><div class="g-score-lbl">Bubbles</div></div>
    </div>
    <canvas id="bCanvas" class="g-canvas" width="${W}" height="${H}"></canvas>
    <div class="g-hint">Move mouse to aim ‚Üí click to shoot! Match 3+ colors!</div>
  `;
  const canvas = document.getElementById('bCanvas');
  const ctx = canvas.getContext('2d');

  function randColor() { return COLORS[Math.floor(Math.random()*COLORS.length)]; }

  function initGrid() {
    grid = [];
    for (let row = 0; row < 5; row++) {
      const off = row % 2 === 1 ? R : 0;
      for (let col = 0; col < COLS; col++) {
        const x = R + col * R*2 + off;
        const y = R + row * (R*1.73);
        if (x > W - R) continue;
        grid.push({ x, y, color: randColor(), row, col });
      }
    }
  }

  function updateCount() {
    const el = document.getElementById('bLeft'); if(el) el.textContent = grid.length;
  }

  function drawBubble(x, y, color, shine=true) {
    ctx.beginPath(); ctx.arc(x, y, R-1, 0, Math.PI*2);
    const g = ctx.createRadialGradient(x-R*0.3, y-R*0.3, 0, x, y, R);
    g.addColorStop(0, lighten(color,40)); g.addColorStop(1, color);
    ctx.fillStyle = g; ctx.fill();
    ctx.strokeStyle = 'rgba(255,255,255,0.2)'; ctx.lineWidth = 1; ctx.stroke();
    if (shine) {
      ctx.beginPath(); ctx.arc(x-R*0.25, y-R*0.25, R*0.25, 0, Math.PI*2);
      ctx.fillStyle = 'rgba(255,255,255,0.35)'; ctx.fill();
    }
  }

  function lighten(hex, amt) {
    const r = parseInt(hex.slice(1,3),16), g2 = parseInt(hex.slice(3,5),16), b2 = parseInt(hex.slice(5,7),16);
    return `rgb(${Math.min(255,r+amt)},${Math.min(255,g2+amt)},${Math.min(255,b2+amt)})`;
  }

  function draw() {
    ctx.clearRect(0,0,W,H);
    // Background
    const bg = ctx.createLinearGradient(0,0,0,H);
    bg.addColorStop(0,'#050510'); bg.addColorStop(1,'#100510');
    ctx.fillStyle = bg; ctx.fillRect(0,0,W,H);
    // Grid bubbles
    grid.forEach(b => drawBubble(b.x, b.y, b.color));
    // Shooter base
    const sx = W/2, sy = H - 30;
    drawBubble(sx, sy, nextColor);
    // Aim line
    const ang = Math.max(-Math.PI+0.1, Math.min(-0.1, mouseAngle));
    ctx.save(); ctx.setLineDash([5,10]); ctx.strokeStyle='rgba(255,255,255,0.2)'; ctx.lineWidth=1;
    ctx.beginPath(); ctx.moveTo(sx,sy);
    let lx=sx, ly=sy, dx=Math.cos(ang)*8, dy=Math.sin(ang)*8;
    for(let i=0;i<25;i++){lx+=dx;ly+=dy;if(lx<R){lx=R;dx*=-1;}if(lx>W-R){lx=W-R;dx*=-1;}if(ly<0)break;}
    ctx.lineTo(lx,ly); ctx.stroke();
    ctx.restore();
    // Flying bullet
    if (bullet) drawBubble(bullet.x, bullet.y, bullet.color);
    // Danger line
    ctx.strokeStyle='rgba(255,102,0,0.3)'; ctx.setLineDash([10,5]); ctx.lineWidth=1;
    ctx.beginPath(); ctx.moveTo(0,H-70); ctx.lineTo(W,H-70); ctx.stroke();
    ctx.setLineDash([]);
    // Danger text
    ctx.fillStyle='rgba(255,102,0,0.4)'; ctx.font='11px Exo 2'; ctx.textAlign='right';
    ctx.fillText('DANGER ZONE', W-10, H-55); ctx.textAlign='left';
  }

  function moveBullet() {
    if (!bullet) return;
    bullet.x += bullet.vx; bullet.y += bullet.vy;
    if (bullet.x < R) { bullet.x=R; bullet.vx*=-1; }
    if (bullet.x > W-R) { bullet.x=W-R; bullet.vx*=-1; }
    // Check collision with grid bubbles
    for (let b of grid) {
      const dx=bullet.x-b.x, dy=bullet.y-b.y;
      if (Math.sqrt(dx*dx+dy*dy) < R*1.85) { snapBullet(); return; }
    }
    // Hit top
    if (bullet.y <= R) { snapBullet(); return; }
    // Miss (fell down)
    if (bullet.y > H+R) { bullet=null; shooting=false; nextColor=randColor(); }
  }

  function snapBullet() {
    if (!bullet) return;
    // Find nearest empty spot
    const nx = Math.round((bullet.x - R) / (R*2));
    const row = Math.round((bullet.y - R) / (R*1.73));
    const off = row % 2 === 1 ? R : 0;
    const x = R + nx*R*2 + off;
    const y = R + row*R*1.73;
    grid.push({ x: Math.max(R, Math.min(W-R, x)), y: Math.max(R, y), color: bullet.color, row, col: nx });
    const color = bullet.color;
    bullet = null; shooting = false; nextColor = randColor();
    // Find connected same-color bubbles
    checkMatches(color, grid[grid.length-1]);
    updateCount();
    if (grid.some(b => b.y >= H-70)) showToast('‚ö†Ô∏è Bubbles reached the bottom!');
    if (grid.length === 0) showToast('üéâ You cleared the board! Score: '+score);
  }

  function checkMatches(color, start) {
    const visited = new Set();
    function flood(b) {
      const key = b.x.toFixed(0)+','+b.y.toFixed(0);
      if (visited.has(key)) return;
      if (b.color !== color) return;
      if (Math.abs(b.x - start.x) > R*8 && visited.size > 0) return;
      visited.add(key);
      grid.forEach(nb => {
        const dx=nb.x-b.x, dy=nb.y-b.y;
        if (Math.sqrt(dx*dx+dy*dy) < R*2.2 && !visited.has(nb.x.toFixed(0)+','+nb.y.toFixed(0)))
          flood(nb);
      });
    }
    flood(start);
    if (visited.size >= 3) {
      score += visited.size * 10;
      const el = document.getElementById('bScore'); if(el) el.textContent=score;
      const keys = [...visited];
      grid = grid.filter(b => !keys.includes(b.x.toFixed(0)+','+b.y.toFixed(0)));
      showToast(`üí• ${visited.size} popped! +${visited.size*10}`);
    }
  }

  addListener(canvas, 'mousemove', e => {
    const rect = canvas.getBoundingClientRect();
    const sx=W/2, sy=H-30;
    mouseAngle = Math.atan2((e.clientY-rect.top)-sy, (e.clientX-rect.left)-sx);
  });

  addListener(canvas, 'click', () => {
    if (shooting) return;
    const ang = Math.max(-Math.PI+0.1, Math.min(-0.1, mouseAngle));
    bullet = { x:W/2, y:H-30, vx:Math.cos(ang)*9, vy:Math.sin(ang)*9, color:nextColor };
    shooting = true;
  });

  addListener(canvas, 'touchstart', e => {
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    const tx = e.touches[0].clientX-rect.left;
    const ty = e.touches[0].clientY-rect.top;
    mouseAngle = Math.atan2(ty-(H-30), tx-W/2);
    if (!shooting) {
      const ang = Math.max(-Math.PI+0.1, Math.min(-0.1, mouseAngle));
      bullet = { x:W/2, y:H-30, vx:Math.cos(ang)*9, vy:Math.sin(ang)*9, color:nextColor };
      shooting = true;
    }
  }, {passive:false});

  initGrid(); updateCount();
  startLoop(() => { moveBullet(); draw(); });
}

/* ==============================================================
   GAME 5: CAR RACING
============================================================== */
function buildCarRace(c) {
  const W=420, H=560;
  let score=0, lives=3, speed=4, roadOff=0, cars=[], keys={}, running=false, frame=0;
  const player = { x:W/2-22, y:H-120, w:44, h:75 };
  const LANES = [75, 155, 235, 315];

  c.innerHTML = `
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="crScore">0</div><div class="g-score-lbl">Score</div></div>
      <div class="g-score-item"><div class="g-score-val" id="crSpeed">60</div><div class="g-score-lbl">km/h</div></div>
      <div class="g-score-item"><div class="g-score-val" id="crLives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div><div class="g-score-lbl">Lives</div></div>
    </div>
    <canvas id="crCanvas" class="g-canvas" width="${W}" height="${H}"></canvas>
    <div class="g-hint">‚Üê ‚Üí Arrow Keys or A/D to steer &nbsp;|&nbsp; Tap left/right half to steer on mobile</div>
    <button class="g-btn" id="crBtn" onclick="crStart()">üèéÔ∏è Start Race!</button>
  `;
  const canvas = document.getElementById('crCanvas');
  const ctx = canvas.getContext('2d');

  function drawRoad() {
    ctx.fillStyle='#1a1a1a'; ctx.fillRect(0,0,W,H);
    ctx.fillStyle='#2a2a2a'; ctx.fillRect(0,0,60,H); ctx.fillRect(W-60,0,60,H);
    // Grass
    ctx.fillStyle='#0a2a0a'; ctx.fillRect(0,0,60,H);
    ctx.fillStyle='#0a2a0a'; ctx.fillRect(W-60,0,60,H);
    // Road surface
    ctx.fillStyle='#333'; ctx.fillRect(60,0,W-120,H);
    // Lane lines
    ctx.setLineDash([30,20]); ctx.strokeStyle='rgba(255,200,0,0.4)'; ctx.lineWidth=2;
    [140, 210, 280].forEach(x => {
      ctx.beginPath(); ctx.moveTo(x, (roadOff%50)-50); ctx.lineTo(x, H); ctx.stroke();
    });
    ctx.setLineDash([]);
    // Road edges
    ctx.strokeStyle='#fff'; ctx.lineWidth=3;
    ctx.beginPath(); ctx.moveTo(60,0); ctx.lineTo(60,H); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(W-60,0); ctx.lineTo(W-60,H); ctx.stroke();
  }

  function drawCar(x, y, w, h, bodyColor, windColor, isPlayer) {
    // Shadow
    ctx.fillStyle='rgba(0,0,0,0.3)'; ctx.beginPath(); ctx.ellipse(x+w/2,y+h+5,w/2,8,0,0,Math.PI*2); ctx.fill();
    // Body
    ctx.fillStyle=bodyColor; ctx.beginPath(); ctx.roundRect(x,y,w,h,6); ctx.fill();
    // Top cabin
    ctx.fillStyle=bodyColor; const cabW=w*0.7, cabX=x+(w-cabW)/2;
    ctx.beginPath(); ctx.roundRect(cabX,y+h*0.15,cabW,h*0.4,4); ctx.fill();
    // Windshields
    ctx.fillStyle=windColor;
    ctx.beginPath(); ctx.roundRect(cabX+2,y+h*0.17,cabW-4,h*0.16,2); ctx.fill(); // front
    ctx.beginPath(); ctx.roundRect(cabX+2,y+h*0.36,cabW-4,h*0.14,2); ctx.fill(); // rear
    // Wheels
    ctx.fillStyle='#111';
    ctx.beginPath(); ctx.ellipse(x+6,y+h*0.2,7,7,0,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.ellipse(x+w-6,y+h*0.2,7,7,0,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.ellipse(x+6,y+h*0.78,7,7,0,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.ellipse(x+w-6,y+h*0.78,7,7,0,0,Math.PI*2); ctx.fill();
    // Wheel rims
    ctx.fillStyle='#666';
    [y+h*0.2, y+h*0.78].forEach(wy => {
      [x+6, x+w-6].forEach(wx => {
        ctx.beginPath(); ctx.arc(wx,wy,3,0,Math.PI*2); ctx.fill();
      });
    });
    // Headlights / taillights
    if (isPlayer) {
      ctx.fillStyle='#fffaaa'; ctx.fillRect(x+3,y+2,8,5); ctx.fillRect(x+w-11,y+2,8,5);
      ctx.fillStyle='#ff3333'; ctx.fillRect(x+3,y+h-7,8,5); ctx.fillRect(x+w-11,y+h-7,8,5);
    } else {
      ctx.fillStyle='#fffaaa'; ctx.fillRect(x+3,y+h-7,8,5); ctx.fillRect(x+w-11,y+h-7,8,5);
      ctx.fillStyle='#ff4444'; ctx.fillRect(x+3,y+2,8,5); ctx.fillRect(x+w-11,y+2,8,5);
    }
  }

  const CAR_COLORS = [['#3b82f6','rgba(180,220,255,0.7)'],['#22c55e','rgba(180,255,200,0.7)'],['#ec4899','rgba(255,180,220,0.7)'],['#8b5cf6','rgba(200,180,255,0.7)'],['#f59e0b','rgba(255,240,180,0.7)']];

  function draw() {
    drawRoad();
    cars.forEach(car => drawCar(car.x, car.y, 44, 70, car.color[0], car.color[1], false));
    drawCar(player.x, player.y, player.w, player.h, '#ff6600', 'rgba(255,220,180,0.7)', true);
    // Exhaust
    if (running && frame%3<2) {
      ctx.fillStyle='rgba(200,200,200,0.3)';
      ctx.beginPath(); ctx.ellipse(player.x+10,player.y+player.h+5,5,8,0,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.ellipse(player.x+player.w-10,player.y+player.h+5,5,8,0,0,Math.PI*2); ctx.fill();
    }
    if (!running && score > 0) {
      ctx.fillStyle='rgba(0,0,0,0.7)'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle='#ff6600'; ctx.font='bold 32px Orbitron'; ctx.textAlign='center';
      ctx.fillText('GAME OVER!', W/2, H/2-20);
      ctx.fillStyle='#fff'; ctx.font='18px Exo 2';
      ctx.fillText('Score: '+score, W/2, H/2+15);
      ctx.textAlign='left';
    }
  }

  function update() {
    if (!running) return;
    frame++; roadOff += speed; score++;
    if (score%300===0 && speed<14) speed+=0.5;
    const s = document.getElementById('crScore'); if(s) s.textContent=score;
    const sp = document.getElementById('crSpeed'); if(sp) sp.textContent=Math.floor(60+score/20);
    // Player movement
    if (keys['ArrowLeft']||keys['a']||keys['A']) player.x = Math.max(65, player.x-5.5);
    if (keys['ArrowRight']||keys['d']||keys['D']) player.x = Math.min(W-65-player.w, player.x+5.5);
    // Spawn enemy cars
    if (Math.random() < 0.018+score/200000) {
      const lane = LANES[Math.floor(Math.random()*LANES.length)];
      const col = CAR_COLORS[Math.floor(Math.random()*CAR_COLORS.length)];
      cars.push({x:lane-22, y:-80, color:col, speed:speed*0.55+Math.random()*1.5});
    }
    cars.forEach(car => car.y += car.speed);
    cars = cars.filter(c => c.y < H+100);
    // Collision
    cars.forEach(car => {
      if (player.x < car.x+40 && player.x+player.w > car.x+4 && player.y < car.y+66 && player.y+player.h > car.y+4) {
        lives--;
        const lv = document.getElementById('crLives'); if(lv) lv.textContent = '‚ù§Ô∏è'.repeat(Math.max(0,lives));
        car.y = H+200; // destroy this car
        showToast(lives>0 ? `üí• Crash! ${lives} lives left` : 'üíÄ No lives left!');
        if (lives <= 0) { running=false; }
      }
    });
    draw();
  }

  window.crStart = function() {
    score=0; lives=3; speed=4; cars=[]; player.x=W/2-22; player.y=H-120; frame=0; running=true;
    const s=document.getElementById('crScore'); if(s) s.textContent=0;
    const sp=document.getElementById('crSpeed'); if(sp) sp.textContent=60;
    const lv=document.getElementById('crLives'); if(lv) lv.textContent='‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è';
    const btn=document.getElementById('crBtn'); if(btn) btn.textContent='Restart';
  };

  addListener(document, 'keydown', e => { keys[e.key]=true; });
  addListener(document, 'keyup', e => { keys[e.key]=false; });

  // Mobile touch controls
  addListener(canvas, 'touchstart', e => { e.preventDefault();
    const rect=canvas.getBoundingClientRect(); const tx=e.touches[0].clientX-rect.left;
    keys[tx<W/2?'ArrowLeft':'ArrowRight']=true;
  }, {passive:false});
  addListener(canvas, 'touchend', e => { keys['ArrowLeft']=false; keys['ArrowRight']=false; });

  draw();
  startLoop(update);
}

/* ==============================================================
   GAME 6: GUN FIGHT
============================================================== */
function buildGunFight(c) {
  const W=500, H=420;
  let enemies=[], bullets=[], particles=[], score=0, ammo=12, wave=1, running=false;
  let mouseX=W/2, mouseY=H/2;

  c.innerHTML=`
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="gfScore">0</div><div class="g-score-lbl">Score</div></div>
      <div class="g-score-item"><div class="g-score-val" id="gfAmmo">12</div><div class="g-score-lbl">Ammo</div></div>
      <div class="g-score-item"><div class="g-score-val" id="gfWave">1</div><div class="g-score-lbl">Wave</div></div>
    </div>
    <canvas id="gfCanvas" class="g-canvas" width="${W}" height="${H}" style="cursor:crosshair"></canvas>
    <div class="g-hint">Click to shoot enemies! Press R to reload. Don't let them reach you!</div>
    <button class="g-btn" id="gfBtn" onclick="gfStart()">‚öîÔ∏è Start!</button>
  `;
  const canvas = document.getElementById('gfCanvas');
  const ctx = canvas.getContext('2d');

  function spawnWave() {
    const count = 3+wave*2;
    for (let i=0; i<count; i++) {
      enemies.push({
        x: 50+Math.random()*(W-100),
        y: -(50+Math.random()*150),
        r: 22, hp: 1+Math.floor(wave/2),
        maxHp: 1+Math.floor(wave/2),
        vx: (Math.random()-0.5)*1.5,
        vy: 0.8+wave*0.25+Math.random()*0.5,
        hue: Math.random()*360,
      });
    }
  }

  function draw() {
    // BG
    const bg=ctx.createLinearGradient(0,0,0,H);
    bg.addColorStop(0,'#0a0a1a'); bg.addColorStop(1,'#1a0a0a');
    ctx.fillStyle=bg; ctx.fillRect(0,0,W,H);
    // Stars
    ctx.fillStyle='rgba(255,255,255,0.4)';
    for(let i=0;i<40;i++) ctx.fillRect((i*73+score)%W,(i*97)%H,1,1);
    // Ground
    ctx.fillStyle='#1a1a1a'; ctx.fillRect(0,H-50,W,50);
    ctx.fillStyle='#ff6600'; ctx.fillRect(0,H-52,W,3);
    // Player (cannon)
    const px=mouseX, py=H-30;
    ctx.fillStyle='#ff6600'; ctx.beginPath(); ctx.roundRect(px-20,py-15,40,30,6); ctx.fill();
    ctx.fillStyle='#ff8833'; ctx.beginPath(); ctx.roundRect(px-8,py-30,16,20,3); ctx.fill();
    ctx.fillStyle='#ffd';
    const ang=Math.atan2(mouseY-py,mouseX-px);
    const bx=px+Math.cos(ang)*30, by=py+Math.sin(ang)*30;
    ctx.beginPath(); ctx.moveTo(px,py); ctx.lineTo(bx,by); // aim line (hidden as gun barrel)
    // Draw gun barrel
    ctx.save(); ctx.translate(px,py); ctx.rotate(Math.atan2(mouseY-py,mouseX-px));
    ctx.fillStyle='#666'; ctx.beginPath(); ctx.roundRect(0,-5,35,10,4); ctx.fill();
    ctx.restore();
    // Bullets
    bullets.forEach(b => {
      ctx.fillStyle='#ffd700';
      const sg=ctx.createRadialGradient(b.x,b.y,0,b.x,b.y,6);
      sg.addColorStop(0,'#fff'); sg.addColorStop(0.4,'#ffd700'); sg.addColorStop(1,'rgba(255,150,0,0)');
      ctx.fillStyle=sg; ctx.beginPath(); ctx.arc(b.x,b.y,6,0,Math.PI*2); ctx.fill();
    });
    // Enemies
    enemies.forEach(e => {
      // Body
      const eg=ctx.createRadialGradient(e.x-5,e.y-5,0,e.x,e.y,e.r);
      eg.addColorStop(0,`hsl(${e.hue},70%,55%)`); eg.addColorStop(1,`hsl(${e.hue},60%,30%)`);
      ctx.fillStyle=eg; ctx.beginPath(); ctx.arc(e.x,e.y,e.r,0,Math.PI*2); ctx.fill();
      ctx.strokeStyle='rgba(255,255,255,0.15)'; ctx.lineWidth=1; ctx.stroke();
      // Eyes
      ctx.fillStyle='rgba(0,0,0,0.8)'; ctx.beginPath(); ctx.arc(e.x-8,e.y-5,5,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(e.x+8,e.y-5,5,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='#f00'; ctx.beginPath(); ctx.arc(e.x-8,e.y-5,2,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(e.x+8,e.y-5,2,0,Math.PI*2); ctx.fill();
      // HP bar
      const bw=e.r*2.5, bx=e.x-e.r*1.25, by2=e.y-e.r-10;
      ctx.fillStyle='#333'; ctx.fillRect(bx,by2,bw,5);
      ctx.fillStyle=e.hp/e.maxHp>0.5?'#22c55e':'#ef4444';
      ctx.fillRect(bx,by2,bw*(e.hp/e.maxHp),5);
    });
    // Particles
    particles.forEach(p => {
      ctx.globalAlpha=p.life; ctx.fillStyle=p.c;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.s*p.life,0,Math.PI*2); ctx.fill();
      ctx.globalAlpha=1;
    });
    // Ammo indicator
    ctx.fillStyle='rgba(0,0,0,0.5)'; ctx.fillRect(10,10,130,20);
    ctx.fillStyle='#ff6600';
    for(let i=0;i<Math.min(ammo,12);i++) {
      ctx.fillRect(12+i*10,13,8,14);
    }
    ctx.fillStyle='#999'; ctx.font='10px Exo 2'; ctx.fillText('AMMO', 10,40);
    if (!running && score>0) {
      ctx.fillStyle='rgba(0,0,0,0.8)'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle='#ff6600'; ctx.font='bold 30px Orbitron'; ctx.textAlign='center';
      ctx.fillText('INVADED!', W/2, H/2-10);
      ctx.fillStyle='#fff'; ctx.font='18px Exo 2'; ctx.fillText('Score: '+score, W/2, H/2+25);
      ctx.textAlign='left';
    }
  }

  function update() {
    if (!running) return;
    // Move enemies
    enemies.forEach(e => {
      e.x+=e.vx; e.y+=e.vy;
      if(e.x<e.r){e.x=e.r;e.vx*=-1;} if(e.x>W-e.r){e.x=W-e.r;e.vx*=-1;}
    });
    // Move bullets
    bullets.forEach(b => { b.x+=b.vx; b.y+=b.vy; });
    // Check hits
    for (let bi=bullets.length-1; bi>=0; bi--) {
      const b=bullets[bi]; let hit=false;
      for (let ei=enemies.length-1; ei>=0; ei--) {
        const e=enemies[ei];
        const dx=b.x-e.x,dy=b.y-e.y;
        if(Math.sqrt(dx*dx+dy*dy)<e.r+4){
          e.hp--; bullets.splice(bi,1); hit=true;
          if(e.hp<=0){
            for(let i=0;i<10;i++) particles.push({x:e.x,y:e.y,vx:(Math.random()-0.5)*7,vy:(Math.random()-0.5)*7,c:`hsl(${e.hue},70%,55%)`,s:4+Math.random()*4,life:1});
            enemies.splice(ei,1);
            score+=10+wave*5;
            const se=document.getElementById('gfScore'); if(se) se.textContent=score;
          }
          break;
        }
      }
    }
    bullets=bullets.filter(b=>b.x>0&&b.x<W&&b.y>0&&b.y<H);
    particles.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=0.15;p.life-=0.04;});
    particles=particles.filter(p=>p.life>0);
    if(enemies.some(e=>e.y>H-50)){running=false;showToast('üò± They reached you! Score: '+score);}
    if(!enemies.length){wave++;document.getElementById('gfWave').textContent=wave;spawnWave();showToast('Wave '+wave+'! Get ready!');}
    draw();
  }

  const aimFn = e => { const r=canvas.getBoundingClientRect(); mouseX=e.clientX-r.left; mouseY=e.clientY-r.top; };
  const shootFn = e => {
    if(!running) return;
    if(ammo<=0){showToast('Empty! Press R to reload');return;}
    const r=canvas.getBoundingClientRect();
    const tx=e.clientX-r.left, ty=e.clientY-r.top;
    const sx=mouseX, sy=H-30;
    const dx=tx-sx,dy=ty-sy,len=Math.sqrt(dx*dx+dy*dy);
    bullets.push({x:sx,y:sy,vx:dx/len*12,vy:dy/len*12});
    ammo--;
    const ae=document.getElementById('gfAmmo'); if(ae) ae.textContent=ammo;
  };
  const reloadFn = e => { if(e.key.toLowerCase()==='r'&&running){ammo=12;const ae=document.getElementById('gfAmmo');if(ae)ae.textContent=12;showToast('üîÑ Reloaded!');} };
  addListener(canvas,'mousemove',aimFn);
  addListener(canvas,'click',shootFn);
  addListener(document,'keydown',reloadFn);
  addListener(canvas,'touchmove',e=>{e.preventDefault();const r=canvas.getBoundingClientRect();mouseX=e.touches[0].clientX-r.left;mouseY=e.touches[0].clientY-r.top;},{passive:false});
  addListener(canvas,'touchend',e=>{if(!running)return;const r=canvas.getBoundingClientRect();const tx=e.changedTouches[0].clientX-r.left,ty=e.changedTouches[0].clientY-r.top;if(ammo>0){const sx=mouseX,sy=H-30,dx=tx-sx,dy=ty-sy,len=Math.sqrt(dx*dx+dy*dy)||1;bullets.push({x:sx,y:sy,vx:dx/len*12,vy:dy/len*12});ammo--;const ae=document.getElementById('gfAmmo');if(ae)ae.textContent=ammo;}});

  window.gfStart = function() {
    score=0;ammo=12;wave=1;enemies=[];bullets=[];particles=[];running=true;
    const sc=document.getElementById('gfScore');if(sc)sc.textContent=0;
    const ae=document.getElementById('gfAmmo');if(ae)ae.textContent=12;
    const we=document.getElementById('gfWave');if(we)we.textContent=1;
    const btn=document.getElementById('gfBtn');if(btn)btn.textContent='Restart';
    spawnWave();
  };
  draw();
  startLoop(update);
}

/* ==============================================================
   GAME 7: ARROW & BOW
============================================================== */
function buildArrowBow(c) {
  const W=500, H=400;
  let targets=[], arrow=null, score=0, shots=15, streak=0, holding=false, holdTime=0, mx=W/2, my=100;

  c.innerHTML=`
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="abScore">0</div><div class="g-score-lbl">Score</div></div>
      <div class="g-score-item"><div class="g-score-val" id="abShots">15</div><div class="g-score-lbl">Arrows</div></div>
      <div class="g-score-item"><div class="g-score-val" id="abStreak">0</div><div class="g-score-lbl">Streak</div></div>
    </div>
    <canvas id="abCanvas" class="g-canvas" width="${W}" height="${H}" style="cursor:crosshair"></canvas>
    <div class="g-hint">Hold mouse button to charge, release to shoot! Hit the center for bonus points!</div>
    <button class="g-btn" onclick="buildArrowBow(document.getElementById('gc'))">New Game</button>
  `;
  const canvas=document.getElementById('abCanvas');
  const ctx=canvas.getContext('2d');
  const AX=55, AY=H/2; // archer position

  function spawnTarget() {
    if(targets.length<4) targets.push({x:200+Math.random()*(W-250),y:60+Math.random()*(H-120),r:40,vx:(Math.random()-0.5)*2.5,vy:(Math.random()-0.5)*1.5});
  }
  for(let i=0;i<3;i++) spawnTarget();

  function drawTarget(t) {
    [[40,'#ef4444'],[28,'#fff'],[18,'#3b82f6'],[8,'#ffd700']].forEach(([r,c]) => {
      ctx.beginPath(); ctx.arc(t.x,t.y,r,0,Math.PI*2); ctx.fillStyle=c; ctx.fill();
    });
    ctx.beginPath(); ctx.arc(t.x,t.y,3,0,Math.PI*2); ctx.fillStyle='#000'; ctx.fill();
  }

  function draw() {
    // Sky bg
    const bg=ctx.createLinearGradient(0,0,0,H);
    bg.addColorStop(0,'#0a1520'); bg.addColorStop(1,'#1a2a10');
    ctx.fillStyle=bg; ctx.fillRect(0,0,W,H);
    // Ground
    ctx.fillStyle='#2a3a10'; ctx.fillRect(0,H-40,W,40);
    ctx.fillStyle='#3a4a15'; ctx.fillRect(0,H-42,W,4);
    // Trees
    ctx.fillStyle='#1a3a0a';
    [80,180,400,480].forEach(x=>{ctx.fillRect(x-8,H-80,16,42);ctx.beginPath();ctx.arc(x,H-90,30,0,Math.PI*2);ctx.fill();});
    // Targets
    targets.forEach(t=>{ t.x+=t.vx; t.y+=t.vy;
      if(t.x<t.r||t.x>W-t.r)t.vx*=-1; if(t.y<t.r||t.y>H-60-t.r)t.vy*=-1;
      drawTarget(t);
    });
    // Archer
    ctx.fillStyle='#ffd'; ctx.beginPath(); ctx.arc(AX,AY-35,10,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#8b4513'; ctx.fillRect(AX-8,AY-24,16,28);
    // Bow
    ctx.strokeStyle='#8b4513'; ctx.lineWidth=3; ctx.beginPath();
    ctx.arc(AX+8,AY-18,28,-1.1,1.1); ctx.stroke();
    // String
    const power = holding ? Math.min((Date.now()-holdTime)/1000,1) : 0;
    const strPull = power*20;
    ctx.strokeStyle=`hsl(${120-power*120},100%,50%)`; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(AX+8,AY-46); ctx.lineTo(AX-strPull,AY-18); ctx.lineTo(AX+8,AY+10); ctx.stroke();
    // Aim line
    const ang=Math.atan2(my-AY+18, mx-AX);
    ctx.save(); ctx.setLineDash([6,12]); ctx.strokeStyle='rgba(255,255,0,0.25)'; ctx.lineWidth=1;
    ctx.beginPath(); ctx.moveTo(AX,AY-18); ctx.lineTo(AX+Math.cos(ang)*120,AY-18+Math.sin(ang)*120); ctx.stroke();
    ctx.restore();
    // Power indicator
    if(holding && power>0) {
      const pw=100;
      ctx.fillStyle='rgba(0,0,0,0.5)'; ctx.fillRect(AX-50,AY-65,pw,10);
      ctx.fillStyle=`hsl(${120-power*120},100%,50%)`; ctx.fillRect(AX-50,AY-65,pw*power,10);
      ctx.fillStyle='#fff'; ctx.font='9px Exo 2'; ctx.textAlign='center'; ctx.fillText('POWER',AX,AY-55); ctx.textAlign='left';
    }
    // Arrow in flight
    if(arrow) {
      ctx.save(); ctx.translate(arrow.x,arrow.y);
      ctx.rotate(Math.atan2(arrow.vy,arrow.vx));
      ctx.strokeStyle='#8b4513'; ctx.lineWidth=2;
      ctx.beginPath(); ctx.moveTo(-20,0); ctx.lineTo(12,0); ctx.stroke();
      ctx.fillStyle='#888'; ctx.beginPath(); ctx.moveTo(12,0); ctx.lineTo(6,-5); ctx.lineTo(6,5); ctx.closePath(); ctx.fill();
      // Feathers
      ctx.fillStyle='#ff6600'; ctx.beginPath(); ctx.moveTo(-20,0); ctx.lineTo(-12,-6); ctx.lineTo(-12,0); ctx.closePath(); ctx.fill();
      ctx.beginPath(); ctx.moveTo(-20,0); ctx.lineTo(-12,6); ctx.lineTo(-12,0); ctx.closePath(); ctx.fill();
      ctx.restore();
    }
    if(shots<=0&&!arrow){
      ctx.fillStyle='rgba(0,0,0,0.7)'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle='#ff6600'; ctx.font='bold 28px Orbitron'; ctx.textAlign='center';
      ctx.fillText('OUT OF ARROWS!', W/2,H/2-10);
      ctx.fillStyle='#fff'; ctx.font='18px Exo 2'; ctx.fillText('Score: '+score,W/2,H/2+25);
      ctx.textAlign='left';
    }
  }

  function update() {
    if(arrow){
      arrow.x+=arrow.vx; arrow.y+=arrow.vy; arrow.vy+=0.35;
      let hit=false;
      targets.forEach((t,i)=>{
        const dx=arrow.x-t.x,dy=arrow.y-t.y,dist=Math.sqrt(dx*dx+dy*dy);
        if(dist<t.r){
          hit=true; streak++;
          const pts = dist<8?100:dist<18?50:dist<28?25:10;
          const bonus = streak>1?' STREAK x'+streak:'';
          score+= pts*(streak>1?Math.min(streak,5):1)|0;
          const se=document.getElementById('abScore');if(se)se.textContent=score;
          const sk=document.getElementById('abStreak');if(sk)sk.textContent=streak;
          showToast(dist<8?'üéØ BULLSEYE! +'+pts*2:'+'+pts+' pts'+bonus);
          targets.splice(i,1); spawnTarget(); if(targets.length<3)spawnTarget();
          arrow=null;
        }
      });
      if(arrow&&(arrow.y>H+50||arrow.x>W+50||arrow.x<-50)){arrow=null;streak=0;const sk=document.getElementById('abStreak');if(sk)sk.textContent=0;}
    }
    draw();
  }

  addListener(canvas,'mousemove',e=>{const r=canvas.getBoundingClientRect();mx=e.clientX-r.left;my=e.clientY-r.top;});
  addListener(canvas,'mousedown',e=>{if(shots>0&&!arrow){holding=true;holdTime=Date.now();}});
  addListener(canvas,'mouseup',()=>{
    if(!holding||shots<=0||arrow)return;
    holding=false;
    const power=Math.min((Date.now()-holdTime)/1000,1);
    const ang=Math.atan2(my-(AY-18),mx-AX);
    const spd=8+power*14;
    arrow={x:AX,y:AY-18,vx:Math.cos(ang)*spd,vy:Math.sin(ang)*spd};
    shots--;
    const se=document.getElementById('abShots');if(se)se.textContent=shots;
  });
  addListener(canvas,'touchstart',e=>{e.preventDefault();if(shots>0&&!arrow){holding=true;holdTime=Date.now();}},{passive:false});
  addListener(canvas,'touchend',e=>{
    e.preventDefault();
    if(!holding||shots<=0||arrow)return;
    holding=false;
    const r=canvas.getBoundingClientRect();
    const tx=e.changedTouches[0].clientX-r.left,ty=e.changedTouches[0].clientY-r.top;
    const power=Math.min((Date.now()-holdTime)/1000,1);
    const ang=Math.atan2(ty-(AY-18),tx-AX);
    const spd=8+power*14;
    arrow={x:AX,y:AY-18,vx:Math.cos(ang)*spd,vy:Math.sin(ang)*spd};
    shots--;
    const se=document.getElementById('abShots');if(se)se.textContent=shots;
  },{passive:false});
  startLoop(update);
}

/* ==============================================================
   GAME 8: HILL CLIMB
============================================================== */
function buildHillClimb(c) {
  const W=480, H=340;
  let distM=0, fuel=100, keys={}, running=false, vel=0, camX=0;
  let carX=120, carY=200, carAngle=0;

  // Generate terrain
  const terrain=[];
  let ty=220;
  for(let x=0;x<5000;x+=8){
    ty+=((Math.random()-0.45)*15);
    ty=Math.max(140,Math.min(300,ty));
    terrain.push(ty);
  }
  function getY(x){const i=Math.floor(x/8);return terrain[Math.min(Math.max(i,0),terrain.length-1)];}

  c.innerHTML=`
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="hcDist">0m</div><div class="g-score-lbl">Distance</div></div>
      <div class="g-score-item"><div class="g-score-val" id="hcFuel">100</div><div class="g-score-lbl">Fuel %</div></div>
    </div>
    <canvas id="hcCanvas" class="g-canvas" width="${W}" height="${H}"></canvas>
    <div class="g-hint">‚Üí / D = Gas &nbsp; ‚Üê / A = Brake. Don't flip! Don't run out of fuel!</div>
    <button class="g-btn" id="hcBtn" onclick="hcStart()">üèîÔ∏è Start!</button>
  `;
  const canvas=document.getElementById('hcCanvas');
  const ctx=canvas.getContext('2d');

  function draw() {
    // Sky
    const sky=ctx.createLinearGradient(0,0,0,H);
    sky.addColorStop(0,'#4a90d9'); sky.addColorStop(1,'#c8e6f5');
    ctx.fillStyle=sky; ctx.fillRect(0,0,W,H);
    // Clouds
    ctx.fillStyle='rgba(255,255,255,0.8)';
    [100,250,380].forEach((cx,i)=>{ctx.beginPath();ctx.ellipse(cx,40+i*10,50,20,0,0,Math.PI*2);ctx.fill();});
    // Terrain
    ctx.beginPath(); ctx.moveTo(0,H);
    for(let px=0;px<=W;px+=8){
      const wx=px+camX;
      const ti=Math.floor(wx/8);
      const ty2=terrain[Math.min(Math.max(ti,0),terrain.length-1)]-camX/30;
      ctx.lineTo(px,ty2);
    }
    ctx.lineTo(W,H); ctx.closePath();
    const tg=ctx.createLinearGradient(0,0,0,H);
    tg.addColorStop(0,'#5a8a3a'); tg.addColorStop(0.15,'#4a7a2a'); tg.addColorStop(1,'#3a5a1a');
    ctx.fillStyle=tg; ctx.fill();
    // Car
    const screenX=carX-camX;
    ctx.save(); ctx.translate(screenX,carY); ctx.rotate(carAngle);
    // Car body
    ctx.fillStyle='#ff6600'; ctx.beginPath(); ctx.roundRect(-28,-16,56,22,4); ctx.fill();
    ctx.fillStyle='#333'; ctx.beginPath(); ctx.roundRect(-18,-28,36,16,3); ctx.fill(); // cabin
    ctx.fillStyle='rgba(150,210,255,0.7)'; ctx.beginPath(); ctx.roundRect(-14,-26,28,12,2); ctx.fill(); // window
    // Wheels
    ctx.fillStyle='#111';
    ctx.beginPath(); ctx.arc(-15,8,12,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(15,8,12,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='#888'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.arc(-15,8,12,0,Math.PI*2); ctx.stroke();
    ctx.beginPath(); ctx.arc(15,8,12,0,Math.PI*2); ctx.stroke();
    ctx.fillStyle='#aaa'; ctx.beginPath(); ctx.arc(-15,8,4,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(15,8,4,0,Math.PI*2); ctx.fill();
    ctx.restore();
    // Fuel bar
    ctx.fillStyle='rgba(0,0,0,0.5)'; ctx.fillRect(10,12,150,16);
    ctx.fillStyle=fuel>30?'#22c55e':'#ef4444';
    ctx.fillRect(12,14,Math.max(0,fuel*1.46),12);
    ctx.fillStyle='#fff'; ctx.font='bold 11px Exo 2'; ctx.fillText('‚õΩ FUEL',15,23);
    if(!running&&distM>0){
      ctx.fillStyle='rgba(0,0,0,0.75)'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle='#ff6600'; ctx.font='bold 26px Orbitron'; ctx.textAlign='center';
      ctx.fillText(Math.abs(carAngle)>1?'üí• FLIPPED!':'‚õΩ OUT OF FUEL!',W/2,H/2-10);
      ctx.fillStyle='#fff'; ctx.font='18px Exo 2'; ctx.fillText('Distance: '+distM+'m',W/2,H/2+25);
      ctx.textAlign='left';
    }
  }

  function update() {
    if(!running) return;
    if(keys['ArrowRight']||keys['d']||keys['D']){vel+=0.18; fuel=Math.max(0,fuel-0.2);}
    if(keys['ArrowLeft']||keys['a']||keys['A']) vel-=0.14;
    vel*=0.97; vel=Math.max(-8,Math.min(14,vel));
    carX+=vel*3;
    if(carX<100) carX=100;
    camX=Math.max(0,carX-150);
    const ty1=getY(carX-20), ty2=getY(carX+20);
    carAngle=Math.atan2(ty2-ty1,40)*0.5;
    const targetY=Math.min(getY(carX)-18,carY+4);
    if(carY>targetY) carY=carY-4; else carY=targetY;
    carY=Math.min(carY,getY(carX)-18);
    distM=Math.floor((carX-120)/10);
    const de=document.getElementById('hcDist');if(de)de.textContent=distM+'m';
    const fe=document.getElementById('hcFuel');if(fe)fe.textContent=Math.floor(fuel);
    if(fuel<=0||Math.abs(carAngle)>1.3){running=false;}
    draw();
  }

  addListener(document,'keydown',e=>{keys[e.key]=true;});
  addListener(document,'keyup',e=>{keys[e.key]=false;});
  addListener(canvas,'touchstart',e=>{e.preventDefault();const r=canvas.getBoundingClientRect();keys[e.touches[0].clientX-r.left<W/2?'ArrowLeft':'ArrowRight']=true;},{passive:false});
  addListener(canvas,'touchend',()=>{keys['ArrowLeft']=false;keys['ArrowRight']=false;});

  window.hcStart=function(){
    fuel=100;vel=0;carX=120;camX=0;carY=220;running=true;
    const fe=document.getElementById('hcFuel');if(fe)fe.textContent=100;
    const de=document.getElementById('hcDist');if(de)de.textContent='0m';
    const btn=document.getElementById('hcBtn');if(btn)btn.textContent='Restart';
  };
  draw();
  startLoop(update);
}

/* ==============================================================
   GAME 9: TEMPLE RUN (Endless Runner)
============================================================== */
function buildTempleRun(c) {
  const W=500, H=340;
  let running=false, score=0, coins=0, speed=5, obstacles=[], coinItems=[], frame=0;
  const GROUND=270;
  const player={x:70,y:GROUND,vy:0,jumping:false,sliding:false,alive:true,runFrame:0};

  c.innerHTML=`
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="trScore">0</div><div class="g-score-lbl">Score</div></div>
      <div class="g-score-item"><div class="g-score-val" id="trCoins">0</div><div class="g-score-lbl">Coins ü™ô</div></div>
    </div>
    <canvas id="trCanvas" class="g-canvas" width="${W}" height="${H}"></canvas>
    <div class="g-hint">‚Üë / SPACE / Click = Jump &nbsp; ‚Üì = Slide</div>
    <button class="g-btn" id="trBtn" onclick="trStart()">üèÉ Run!</button>
  `;
  const canvas=document.getElementById('trCanvas');
  const ctx=canvas.getContext('2d');

  function draw() {
    // BG
    const bg=ctx.createLinearGradient(0,0,0,H);
    bg.addColorStop(0,'#1a0a00'); bg.addColorStop(0.6,'#2a1500'); bg.addColorStop(1,'#1a0a00');
    ctx.fillStyle=bg; ctx.fillRect(0,0,W,H);
    // Temple BG
    ctx.fillStyle='rgba(100,70,30,0.3)';
    ctx.beginPath(); ctx.moveTo(0,H-80); ctx.lineTo(0,120); ctx.lineTo(60,80); ctx.lineTo(120,120);
    ctx.lineTo(120,H-80); ctx.closePath(); ctx.fill();
    // Ground
    ctx.fillStyle='#3d2200'; ctx.fillRect(0,GROUND+18,W,H-GROUND);
    ctx.fillStyle='#5a3300'; ctx.fillRect(0,GROUND+18,W,8);
    // Ground tiles
    ctx.strokeStyle='rgba(255,150,50,0.15)'; ctx.lineWidth=1;
    for(let x=(frame*speed)%60;x<W;x+=60){ctx.beginPath();ctx.moveTo(x,GROUND+18);ctx.lineTo(x,H);ctx.stroke();}
    // Torches (BG decoration)
    [80,230,380].forEach((tx,i)=>{
      const flicker=Math.sin(Date.now()/100+i)*0.3+0.7;
      ctx.fillStyle='#5a3a1a'; ctx.fillRect(tx-4,GROUND-40,8,40);
      const fg=ctx.createRadialGradient(tx,GROUND-45,0,tx,GROUND-45,20);
      fg.addColorStop(0,`rgba(255,200,50,${flicker})`); fg.addColorStop(1,'rgba(255,100,0,0)');
      ctx.fillStyle=fg; ctx.beginPath(); ctx.arc(tx,GROUND-45,20,0,Math.PI*2); ctx.fill();
    });
    // Coins
    coinItems.forEach(ci=>{
      ctx.fillStyle='#ffd700';
      const cg=ctx.createRadialGradient(ci.x,ci.y,0,ci.x,ci.y,8);
      cg.addColorStop(0,'#fff'); cg.addColorStop(0.3,'#ffd700'); cg.addColorStop(1,'#b8860b');
      ctx.fillStyle=cg; ctx.beginPath(); ctx.arc(ci.x,ci.y,8,0,Math.PI*2); ctx.fill();
      ctx.strokeStyle='#fff'; ctx.lineWidth=1; ctx.stroke();
    });
    // Obstacles
    obstacles.forEach(o=>{
      if(o.type==='rock'){
        ctx.fillStyle='#5a4a3a'; ctx.beginPath();
        ctx.arc(o.x,o.y,o.w/2,0,Math.PI*2); ctx.fill();
        ctx.fillStyle='#6a5a4a'; ctx.beginPath(); ctx.arc(o.x-o.w/5,o.y-o.w/5,o.w/3,0,Math.PI*2); ctx.fill();
      } else if(o.type==='log'){
        ctx.fillStyle='#4a2a10'; ctx.beginPath(); ctx.roundRect(o.x-o.w/2,o.y-o.h,o.w,o.h,4); ctx.fill();
        ctx.strokeStyle='#6a4a20'; ctx.lineWidth=2; ctx.beginPath(); ctx.roundRect(o.x-o.w/2,o.y-o.h,o.w,o.h,4); ctx.stroke();
      } else {
        // low bar (must slide)
        ctx.fillStyle='#8b4513'; ctx.fillRect(o.x-2,GROUND-55,4,55);
        ctx.fillStyle='#6a3300'; ctx.fillRect(o.x-30,GROUND-60,60,10);
      }
    });
    // Player
    const py=player.sliding?player.y+20:player.y;
    const ph=player.sliding?35:55;
    if(player.alive){
      // Body
      ctx.fillStyle='#ff6600'; ctx.beginPath(); ctx.roundRect(player.x-10,py-ph+18,20,player.sliding?14:25,3); ctx.fill();
      // Head
      ctx.fillStyle='#ffd'; ctx.beginPath(); ctx.arc(player.x,py-ph+12,11,0,Math.PI*2); ctx.fill();
      // Hair
      ctx.fillStyle='#333'; ctx.fillRect(player.x-10,py-ph+2,20,8);
      // Legs (animated)
      if(!player.sliding){
        const lf=Math.sin(frame*0.35)*12;
        ctx.fillStyle='#333'; ctx.strokeStyle='#333'; ctx.lineWidth=3; ctx.lineCap='round';
        ctx.beginPath(); ctx.moveTo(player.x-3,py-12); ctx.lineTo(player.x-6+lf,py+2); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(player.x+3,py-12); ctx.lineTo(player.x+6-lf,py+2); ctx.stroke();
      }
      // Arms
      const af=Math.sin(frame*0.35)*8;
      ctx.lineWidth=2;
      ctx.beginPath(); ctx.moveTo(player.x,py-ph+25); ctx.lineTo(player.x-14+af,py-ph+35); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(player.x,py-ph+25); ctx.lineTo(player.x+14-af,py-ph+35); ctx.stroke();
    } else {
      // Dead X eyes
      ctx.fillStyle='#ffd'; ctx.beginPath(); ctx.arc(player.x,py-40,11,0,Math.PI*2); ctx.fill();
      ctx.strokeStyle='#ef4444'; ctx.lineWidth=2;
      ctx.beginPath(); ctx.moveTo(player.x-6,py-45); ctx.lineTo(player.x+6,py-35); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(player.x+6,py-45); ctx.lineTo(player.x-6,py-35); ctx.stroke();
    }
    if(!running&&score>0){
      ctx.fillStyle='rgba(0,0,0,0.75)'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle='#ff6600'; ctx.font='bold 26px Orbitron'; ctx.textAlign='center';
      ctx.fillText('üíÄ GAME OVER', W/2,H/2-15);
      ctx.fillStyle='#ffd700'; ctx.font='16px Exo 2'; ctx.fillText('Score: '+score+' | Coins: '+coins,W/2,H/2+20);
      ctx.textAlign='left';
    }
  }

  function update(){
    if(!running) return;
    frame++; score++;
    if(score%600===0&&speed<12) speed+=0.5;
    player.runFrame++;
    const se=document.getElementById('trScore');if(se)se.textContent=score;
    player.vy+=0.55; player.y=Math.min(GROUND,player.y+player.vy);
    if(player.y>=GROUND){player.y=GROUND;player.vy=0;player.jumping=false;}
    if(Math.random()<0.016) obstacles.push({x:W+30,y:GROUND,w:28+Math.random()*20,h:24+Math.random()*18,type:Math.random()<0.4?'rock':Math.random()<0.5?'log':'bar'});
    if(Math.random()<0.025) coinItems.push({x:W+10,y:GROUND-25-Math.random()*80});
    obstacles.forEach(o=>o.x-=speed);
    coinItems.forEach(ci=>ci.x-=speed);
    obstacles=obstacles.filter(o=>o.x>-60);
    coinItems=coinItems.filter(ci=>ci.x>-20);
    // Coin collect
    coinItems.forEach((ci,i)=>{
      if(Math.abs(player.x-ci.x)<18&&Math.abs(player.y-player.h/2-ci.y)<20){
        coins++; const ce=document.getElementById('trCoins');if(ce)ce.textContent=coins;
        coinItems.splice(i,1); showToast('ü™ô +1 Coin!');
      }
    });
    // Collision with obstacles
    obstacles.forEach(o=>{
      let hit=false;
      const ph=player.sliding?35:55;
      const py=player.sliding?player.y+20:player.y;
      if(o.type==='bar'){
        if(!player.sliding&&player.x+12>o.x-30&&player.x-12<o.x+30&&py-ph<GROUND-50) hit=true;
      } else {
        const hw=o.type==='rock'?o.w/2:o.w/2;
        if(player.x+10>o.x-hw&&player.x-10<o.x+hw&&py>o.y-o.h&&py-ph<o.y) hit=true;
      }
      if(hit){running=false;player.alive=false;showToast('üí• Game Over! Score: '+score);}
    });
    draw();
  }

  function jump(){if(running&&!player.jumping&&!player.sliding){player.vy=-13;player.jumping=true;}}
  const keyFn=e=>{if(e.key===' '||e.key==='ArrowUp'){e.preventDefault();jump();}if(e.key==='ArrowDown')player.sliding=true;};
  const keyUpFn=e=>{if(e.key==='ArrowDown')player.sliding=false;};
  addListener(document,'keydown',keyFn);
  addListener(document,'keyup',keyUpFn);
  addListener(canvas,'click',jump);
  addListener(canvas,'touchstart',e=>{e.preventDefault();const r=canvas.getBoundingClientRect();if(e.touches[0].clientY-r.top>H/2)player.sliding=true;else jump();},{passive:false});
  addListener(canvas,'touchend',()=>{player.sliding=false;});

  window.trStart=function(){
    score=0;coins=0;speed=5;obstacles=[];coinItems=[];frame=0;
    player.x=70;player.y=GROUND;player.vy=0;player.jumping=false;player.sliding=false;player.alive=true;running=true;
    const se=document.getElementById('trScore');if(se)se.textContent=0;
    const ce=document.getElementById('trCoins');if(ce)ce.textContent=0;
    const btn=document.getElementById('trBtn');if(btn)btn.textContent='Restart';
  };
  draw();
  startLoop(update);
}

/* ==============================================================
   GAME 10: TETRIS (Box Fill)
============================================================== */
function buildTetris(c) {
  const COLS=10, ROWS=20, SZ=26, PW=100;
  const PIECES=[
    {s:[[1,1,1,1]],c:'#00e5ff'},
    {s:[[1,1],[1,1]],c:'#ffd600'},
    {s:[[0,1,0],[1,1,1]],c:'#aa00ff'},
    {s:[[1,1,0],[0,1,1]],c:'#ff1744'},
    {s:[[0,1,1],[1,1,0]],c:'#00e676'},
    {s:[[1,0,0],[1,1,1]],c:'#ff6d00'},
    {s:[[0,0,1],[1,1,1]],c:'#1565c0'},
  ];

  c.innerHTML=`
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="ttScore">0</div><div class="g-score-lbl">Score</div></div>
      <div class="g-score-item"><div class="g-score-val" id="ttLines">0</div><div class="g-score-lbl">Lines</div></div>
      <div class="g-score-item"><div class="g-score-val" id="ttLevel">1</div><div class="g-score-lbl">Level</div></div>
    </div>
    <div style="display:flex;gap:1rem;align-items:flex-start;justify-content:center;flex-wrap:wrap">
      <canvas id="ttCanvas" class="g-canvas" width="${COLS*SZ}" height="${ROWS*SZ}"></canvas>
      <div style="display:flex;flex-direction:column;gap:0.8rem;align-items:center">
        <div style="background:var(--card2);border:1px solid var(--border);border-radius:8px;padding:10px;text-align:center">
          <div style="font-size:0.65rem;color:var(--gray);letter-spacing:1px;margin-bottom:6px;">NEXT</div>
          <canvas id="ttNext" width="${PW}" height="${PW}"></canvas>
        </div>
        <div style="background:var(--card2);border:1px solid var(--border);border-radius:8px;padding:10px;font-size:0.75rem;color:var(--gray);line-height:1.9;text-align:center">
          ‚Üê ‚Üí Move<br>‚Üë Rotate<br>‚Üì Soft drop<br>SPACE Hard drop
        </div>
        <button class="g-btn" id="ttBtn" onclick="ttStart()">‚ñ∂ Start</button>
        <button class="g-btn secondary" onclick="ttPause()">‚è∏ Pause</button>
      </div>
    </div>
  `;
  const canvas=document.getElementById('ttCanvas');
  const ctx=canvas.getContext('2d');
  const nextCanvas=document.getElementById('ttNext');
  const nctx=nextCanvas.getContext('2d');
  let grid, cur, nxt, score=0, lines=0, level=1, running=false, paused=false, interval;

  function newGrid(){grid=Array.from({length:ROWS},()=>Array(COLS).fill(0));}
  function randPiece(){const p=PIECES[Math.floor(Math.random()*PIECES.length)];return{s:p.s.map(r=>[...r]),c:p.c,x:Math.floor(COLS/2-p.s[0].length/2),y:0};}

  function drawBlock(ctx2,x,y,sz,color){
    ctx2.fillStyle=color; ctx2.fillRect(x+1,y+1,sz-2,sz-2);
    ctx2.fillStyle='rgba(255,255,255,0.25)'; ctx2.fillRect(x+1,y+1,sz-2,3);
    ctx2.fillStyle='rgba(0,0,0,0.2)'; ctx2.fillRect(x+1,y+sz-4,sz-2,3);
  }

  function drawBoard(){
    ctx.fillStyle='#050510'; ctx.fillRect(0,0,COLS*SZ,ROWS*SZ);
    // Grid lines
    ctx.strokeStyle='rgba(255,255,255,0.03)'; ctx.lineWidth=0.5;
    for(let x=0;x<=COLS;x++){ctx.beginPath();ctx.moveTo(x*SZ,0);ctx.lineTo(x*SZ,ROWS*SZ);ctx.stroke();}
    for(let y=0;y<=ROWS;y++){ctx.beginPath();ctx.moveTo(0,y*SZ);ctx.lineTo(COLS*SZ,y*SZ);ctx.stroke();}
    // Settled blocks
    grid.forEach((row,r)=>row.forEach((c,col)=>{if(c) drawBlock(ctx,col*SZ,r*SZ,SZ,c);}));
    // Ghost piece
    if(cur&&running&&!paused){
      let gy=cur.y;
      while(!collides({...cur,y:gy+1})) gy++;
      cur.s.forEach((row,r)=>row.forEach((c,col)=>{
        if(c){ctx.fillStyle='rgba(255,255,255,0.1)';ctx.fillRect((cur.x+col)*SZ+1,(gy+r)*SZ+1,SZ-2,SZ-2);}
      }));
      // Current piece
      cur.s.forEach((row,r)=>row.forEach((c,col)=>{if(c) drawBlock(ctx,(cur.x+col)*SZ,(cur.y+r)*SZ,SZ,cur.c);}));
    }
    if(paused){ctx.fillStyle='rgba(0,0,0,0.7)';ctx.fillRect(0,0,COLS*SZ,ROWS*SZ);ctx.fillStyle='#ff6600';ctx.font='bold 20px Orbitron';ctx.textAlign='center';ctx.fillText('PAUSED',COLS*SZ/2,ROWS*SZ/2);ctx.textAlign='left';}
    if(!running&&score>0){ctx.fillStyle='rgba(0,0,0,0.8)';ctx.fillRect(0,0,COLS*SZ,ROWS*SZ);ctx.fillStyle='#ff6600';ctx.font='bold 18px Orbitron';ctx.textAlign='center';ctx.fillText('GAME OVER',COLS*SZ/2,ROWS*SZ/2-15);ctx.fillStyle='#fff';ctx.font='14px Exo 2';ctx.fillText('Score:'+score,COLS*SZ/2,ROWS*SZ/2+15);ctx.textAlign='left';}
  }

  function drawNext(){
    nctx.fillStyle='#050510'; nctx.fillRect(0,0,PW,PW);
    if(!nxt) return;
    const ox=Math.floor((PW-(nxt.s[0].length*SZ))/2);
    const oy=Math.floor((PW-(nxt.s.length*SZ))/2);
    nxt.s.forEach((row,r)=>row.forEach((c,col)=>{if(c) drawBlock(nctx,ox+col*SZ,oy+r*SZ,SZ,nxt.c);}));
  }

  function collides(p){
    return p.s.some((row,r)=>row.some((c,col)=>{
      if(!c) return false;
      const nx=p.x+col,ny=p.y+r;
      return nx<0||nx>=COLS||ny>=ROWS||(ny>=0&&grid[ny][nx]);
    }));
  }

  function merge(){cur.s.forEach((row,r)=>row.forEach((c,col)=>{if(c&&cur.y+r>=0) grid[cur.y+r][cur.x+col]=cur.c;}));}

  function clearLines(){
    let cleared=0;
    for(let r=ROWS-1;r>=0;r--){
      if(grid[r].every(Boolean)){grid.splice(r,1);grid.unshift(Array(COLS).fill(0));cleared++;r++;}
    }
    if(cleared){
      lines+=cleared; score+=[0,100,300,500,800][cleared]*level;
      level=Math.floor(lines/10)+1;
      ['ttScore','ttLines','ttLevel'].forEach((id,i)=>{const e=document.getElementById(id);if(e)e.textContent=[score,lines,level][i];});
      clearInterval(interval); interval=addInterval(drop,Math.max(80,500-level*40));
    }
  }

  function drop(){
    if(!running||paused) return;
    cur.y++;
    if(collides(cur)){
      cur.y--;
      merge(); clearLines();
      cur=nxt; nxt=randPiece(); drawNext();
      if(collides(cur)){running=false;clearInterval(interval);drawBoard();}
    }
    drawBoard();
  }

  const keyFn=e=>{
    if(!running||paused) return;
    if(e.key==='ArrowLeft'){cur.x--;if(collides(cur))cur.x++;}
    else if(e.key==='ArrowRight'){cur.x++;if(collides(cur))cur.x--;}
    else if(e.key==='ArrowDown'){cur.y++;if(collides(cur))cur.y--;score++;const se=document.getElementById('ttScore');if(se)se.textContent=score;}
    else if(e.key==='ArrowUp'){
      const rot=cur.s[0].map((_,i)=>cur.s.map(r=>r[i]).reverse());
      const orig=cur.s;cur.s=rot;
      if(collides(cur)){cur.x--;if(collides(cur)){cur.x+=2;if(collides(cur)){cur.x--;cur.s=orig;}}}
    }
    else if(e.key===' '){e.preventDefault();while(!collides({...cur,y:cur.y+1})){cur.y++;score++;}const se=document.getElementById('ttScore');if(se)se.textContent=score;}
    else return;
    drawBoard();
  };
  addListener(document,'keydown',keyFn);

  window.ttStart=function(){
    newGrid();cur=randPiece();nxt=randPiece();score=0;lines=0;level=1;paused=false;running=true;
    ['ttScore','ttLines','ttLevel'].forEach(id=>{const e=document.getElementById(id);if(e)e.textContent=id==='ttLevel'?1:0;});
    const btn=document.getElementById('ttBtn');if(btn)btn.textContent='Restart';
    clearInterval(interval);interval=addInterval(drop,500);drawNext();drawBoard();
  };
  window.ttPause=function(){if(!running)return;paused=!paused;drawBoard();};
  drawBoard();drawNext();
}

/* ==============================================================
   GAME 11: GLASS HIT
============================================================== */
function buildGlassHit(c) {
  const W=500, H=360;
  let targets=[], score=0, hits=0, combo=0, particles=[];

  c.innerHTML=`
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="ghScore">0</div><div class="g-score-lbl">Score</div></div>
      <div class="g-score-item"><div class="g-score-val" id="ghHits">0</div><div class="g-score-lbl">Hits</div></div>
      <div class="g-score-item"><div class="g-score-val" id="ghCombo">x1</div><div class="g-score-lbl">Combo</div></div>
    </div>
    <canvas id="ghCanvas" class="g-canvas" width="${W}" height="${H}" style="cursor:crosshair"></canvas>
    <div class="g-hint">Click/tap the glowing targets before they fade! Faster clicks = more combo!</div>
    <button class="g-btn" onclick="buildGlassHit(document.getElementById('gc'))">New Game</button>
  `;
  const canvas=document.getElementById('ghCanvas');
  const ctx=canvas.getContext('2d');

  function spawnTarget(){
    const shapes=['circle','square','diamond'];
    targets.push({
      x:50+Math.random()*(W-100), y:50+Math.random()*(H-100),
      r:25+Math.random()*20, maxLife:2.5+Math.random()*2,
      life:1, born:Date.now(),
      hue:Math.random()*360, shape:shapes[Math.floor(Math.random()*3)],
    });
  }

  function draw(){
    ctx.fillStyle='#050510'; ctx.fillRect(0,0,W,H);
    // BG glass texture
    ctx.save(); ctx.globalAlpha=0.05;
    for(let i=0;i<15;i++){ctx.strokeStyle=`hsl(${200+i*10},60%,70%)`;ctx.lineWidth=0.5;ctx.beginPath();ctx.moveTo(Math.random()*W,0);ctx.lineTo(Math.random()*W,H);ctx.stroke();}
    ctx.restore();

    targets.forEach(t=>{
      const age=(Date.now()-t.born)/1000;
      t.life=Math.max(0,1-age/t.maxLife);
      if(t.life<=0)return;
      const pulse=0.85+Math.sin(Date.now()/180)*0.15;
      ctx.save();ctx.globalAlpha=t.life;
      // Glow
      const gg=ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,t.r*2.5);
      gg.addColorStop(0,`hsla(${t.hue},80%,60%,${t.life*0.4})`); gg.addColorStop(1,'transparent');
      ctx.fillStyle=gg; ctx.beginPath(); ctx.arc(t.x,t.y,t.r*2.5,0,Math.PI*2); ctx.fill();
      // Glass body
      const gfill=ctx.createRadialGradient(t.x-t.r*0.3,t.y-t.r*0.3,0,t.x,t.y,t.r);
      gfill.addColorStop(0,`hsla(${t.hue},60%,80%,${t.life*0.25})`); gfill.addColorStop(1,`hsla(${t.hue},70%,50%,${t.life*0.15})`);
      ctx.fillStyle=gfill; ctx.strokeStyle=`hsla(${t.hue},80%,60%,${t.life})`;
      ctx.lineWidth=2;
      if(t.shape==='circle'){
        ctx.beginPath(); ctx.arc(t.x,t.y,t.r*pulse,0,Math.PI*2); ctx.fill(); ctx.stroke();
      } else if(t.shape==='square'){
        ctx.beginPath(); ctx.roundRect(t.x-t.r*pulse,t.y-t.r*pulse,t.r*2*pulse,t.r*2*pulse,6); ctx.fill(); ctx.stroke();
      } else {
        ctx.beginPath(); ctx.moveTo(t.x,t.y-t.r*pulse); ctx.lineTo(t.x+t.r*pulse,t.y); ctx.lineTo(t.x,t.y+t.r*pulse); ctx.lineTo(t.x-t.r*pulse,t.y); ctx.closePath(); ctx.fill(); ctx.stroke();
      }
      // Crosshair
      ctx.strokeStyle=`hsla(${t.hue},100%,80%,${t.life*0.6})`;ctx.lineWidth=1;
      ctx.beginPath();ctx.moveTo(t.x-t.r-5,t.y);ctx.lineTo(t.x+t.r+5,t.y);ctx.stroke();
      ctx.beginPath();ctx.moveTo(t.x,t.y-t.r-5);ctx.lineTo(t.x,t.y+t.r+5);ctx.stroke();
      // Life ring
      ctx.strokeStyle=`hsla(${t.hue},100%,60%,${t.life})`;ctx.lineWidth=2;
      ctx.beginPath();ctx.arc(t.x,t.y,t.r+5,0,Math.PI*2*t.life);ctx.stroke();
      ctx.restore();
    });

    particles.forEach(p=>{
      ctx.globalAlpha=p.life;ctx.fillStyle=p.c;
      ctx.beginPath();ctx.arc(p.x,p.y,p.s*p.life,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;
    });
  }

  function update(){
    targets=targets.filter(t=>{const age=(Date.now()-t.born)/1000;return age<t.maxLife;});
    while(targets.length<5)spawnTarget();
    particles.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=0.08;p.life-=0.03;});
    particles=particles.filter(p=>p.life>0);
    draw();
  }

  addListener(canvas,'click',e=>{
    const r=canvas.getBoundingClientRect();
    const mx=e.clientX-r.left,my=e.clientY-r.top;
    let hitAny=false;
    targets.forEach((t,i)=>{
      const dx=mx-t.x,dy=my-t.y;
      if(Math.sqrt(dx*dx+dy*dy)<t.r+5){
        combo++;hitAny=true;
        for(let p=0;p<14;p++) particles.push({x:t.x,y:t.y,vx:(Math.random()-0.5)*9,vy:(Math.random()-0.5)*9-2,s:3+Math.random()*5,life:1,c:`hsla(${t.hue},80%,60%,1)`});
        const pts=Math.floor(t.life*80)+20+combo*5;
        score+=pts;hits++;
        ['ghScore','ghHits'].forEach((id,idx)=>{const e=document.getElementById(id);if(e)e.textContent=[score,hits][idx];});
        const ce=document.getElementById('ghCombo');if(ce)ce.textContent='x'+Math.min(combo,10);
        showToast((t.life>0.8?'PERFECT! ':'')+(combo>2?'COMBO x'+combo+' ':'')+('+'+pts));
        targets.splice(i,1);
      }
    });
    if(!hitAny){combo=0;const ce=document.getElementById('ghCombo');if(ce)ce.textContent='x1';}
  });
  addListener(canvas,'touchstart',e=>{e.preventDefault();canvas.dispatchEvent(new MouseEvent('click',{clientX:e.touches[0].clientX,clientY:e.touches[0].clientY}));},{passive:false});
  startLoop(update);
}

/* ==============================================================
   GAME 12: NOT A ROBOT
============================================================== */
function buildNotARobot(c) {
  const chars='ABCDEFGHJKMNPQRSTUVWXYZ23456789';
  function gen(){return Array.from({length:6},()=>chars[Math.floor(Math.random()*chars.length)]).join('');}
  let captcha=gen(), stage=0;

  c.innerHTML=`
    <div class="robot-panel">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:1.2rem;">
        <div style="background:var(--orange);width:4px;height:24px;border-radius:2px;"></div>
        <h3 style="font-family:'Orbitron',monospace;font-size:1rem;">Security Verification</h3>
      </div>
      <div id="narS1">
        <div class="robot-checkbox-row" onclick="narStep1()">
          <input type="checkbox" class="robot-cb" id="narCb" onclick="narStep1();event.stopPropagation()">
          <label for="narCb" style="font-weight:600;cursor:pointer;">I am not a robot</label>
          <div style="margin-left:auto;display:flex;flex-direction:column;align-items:center;gap:2px;">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' fill='%234a90d9'/%3E%3Ctext y='50' x='8' font-size='40'%3Eüõ°Ô∏è%3C/text%3E%3C/svg%3E" width="32" height="32" style="border-radius:4px;" alt="">
            <div style="font-size:0.55rem;color:var(--gray);">reCAPTCHA</div>
          </div>
        </div>
      </div>
      <div id="narS2" style="display:none">
        <p style="color:var(--gray);font-size:0.85rem;margin-bottom:0.8rem;">Type the characters you see in the image:</p>
        <div class="captcha-display" id="narImg">${captcha}</div>
        <input class="captcha-in" id="narIn" placeholder="Enter characters..." maxlength="6">
        <div style="display:flex;gap:8px;">
          <button class="g-btn" onclick="narCheck()">Verify ‚úì</button>
          <button class="g-btn secondary" onclick="narRefresh()">üîÑ New</button>
        </div>
        <div id="narMsg" style="margin-top:0.8rem;font-size:0.9rem;min-height:20px;"></div>
      </div>
      <div id="narS3" style="display:none;text-align:center;padding:1.5rem 0;">
        <div style="font-size:5rem;margin-bottom:1rem;">‚úÖ</div>
        <h3 style="font-family:'Orbitron',monospace;color:#22c55e;margin-bottom:0.5rem;">Verified!</h3>
        <p style="color:var(--gray);margin-bottom:1.5rem;">You are definitely human. Welcome to GameFlow!</p>
        <div style="background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.3);border-radius:10px;padding:1rem;margin-bottom:1rem;">
          <div style="font-family:'Orbitron',monospace;font-size:2rem;color:#22c55e;">9,872</div>
          <div style="color:var(--gray);font-size:0.75rem;letter-spacing:1px;">HUMANITY SCORE</div>
        </div>
        <button class="g-btn" onclick="buildNotARobot(document.getElementById('gc'))">Try Again</button>
      </div>
    </div>
  `;

  window.narStep1=function(){
    const cb=document.getElementById('narCb');if(!cb)return;
    cb.checked=true;
    setTimeout(()=>{
      const s1=document.getElementById('narS1'),s2=document.getElementById('narS2');
      if(s1)s1.style.display='none';if(s2)s2.style.display='block';
    },1200);
  };
  window.narCheck=function(){
    const inp=document.getElementById('narIn');if(!inp)return;
    const val=inp.value.toUpperCase();
    const msg=document.getElementById('narMsg');if(!msg)return;
    if(val===captcha){
      msg.innerHTML='<span style="color:#22c55e">‚úì Correct! Verifying...</span>';
      setTimeout(()=>{const s2=document.getElementById('narS2'),s3=document.getElementById('narS3');if(s2)s2.style.display='none';if(s3)s3.style.display='block';},800);
    } else {
      msg.innerHTML='<span style="color:#ef4444">‚úó Wrong! Please try again.</span>';
      inp.value=''; narRefresh();
    }
  };
  window.narRefresh=function(){
    captcha=gen();
    const img=document.getElementById('narImg');if(img)img.textContent=captcha;
    const inp=document.getElementById('narIn');if(inp)inp.value='';
    const msg=document.getElementById('narMsg');if(msg)msg.innerHTML='';
  };
}

/* ==============================================================
   GAME 13: BIKE RACING
============================================================== */
function buildBikeRace(c) {
  const W=420, H=560;
  let score=0,lives=3,speed=4,roadOff=0,obstacles=[],keys={},running=false;
  const player={x:W/2-15,y:H-110,w:30,h:65};
  const LANES=[80,155,230,305];

  c.innerHTML=`
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="brScore">0</div><div class="g-score-lbl">Score</div></div>
      <div class="g-score-item"><div class="g-score-val" id="brSpeed">40</div><div class="g-score-lbl">km/h</div></div>
      <div class="g-score-item"><div class="g-score-val" id="brLives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div><div class="g-score-lbl">Lives</div></div>
    </div>
    <canvas id="brCanvas" class="g-canvas" width="${W}" height="${H}"></canvas>
    <div class="g-hint">‚Üê ‚Üí Arrow keys to steer your bike!</div>
    <button class="g-btn" id="brBtn" onclick="brStart()">üèçÔ∏è Start!</button>
  `;
  const canvas=document.getElementById('brCanvas');
  const ctx=canvas.getContext('2d');
  const OB_COLORS=[['#3b82f6','rgba(150,200,255,0.7)'],['#22c55e','rgba(150,255,180,0.7)'],['#ec4899','rgba(255,150,200,0.7)'],['#8b5cf6','rgba(200,150,255,0.7)']];

  function drawBike(x,y){
    ctx.fillStyle='rgba(0,0,0,0.2)'; ctx.beginPath(); ctx.ellipse(x+15,y+67,20,6,0,0,Math.PI*2); ctx.fill();
    // Frame
    ctx.strokeStyle='#ff6600'; ctx.lineWidth=4; ctx.lineCap='round';
    ctx.beginPath(); ctx.moveTo(x+5,y+55); ctx.lineTo(x+25,y+55); ctx.stroke(); // axle
    ctx.beginPath(); ctx.moveTo(x+15,y+55); ctx.lineTo(x+15,y+25); ctx.stroke(); // center
    ctx.beginPath(); ctx.moveTo(x+5,y+55); ctx.lineTo(x+15,y+25); ctx.stroke(); // fork
    ctx.beginPath(); ctx.moveTo(x+25,y+55); ctx.lineTo(x+20,y+30); ctx.stroke(); // rear
    // Wheels
    ctx.strokeStyle='#111'; ctx.lineWidth=6;
    ctx.beginPath(); ctx.arc(x+5,y+58,10,0,Math.PI*2); ctx.stroke();
    ctx.beginPath(); ctx.arc(x+25,y+58,10,0,Math.PI*2); ctx.stroke();
    ctx.strokeStyle='#888'; ctx.lineWidth=1;
    ctx.beginPath(); ctx.arc(x+5,y+58,10,0,Math.PI*2); ctx.stroke();
    ctx.beginPath(); ctx.arc(x+25,y+58,10,0,Math.PI*2); ctx.stroke();
    // Rider
    ctx.fillStyle='#ffd'; ctx.beginPath(); ctx.arc(x+15,y+14,9,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#ff6600'; ctx.beginPath(); ctx.roundRect(x+8,y+22,14,22,3); ctx.fill();
    ctx.fillStyle='#333'; ctx.fillRect(x+7,y+6,16,10); // helmet
    ctx.fillStyle='rgba(150,210,255,0.5)'; ctx.fillRect(x+9,y+8,12,5); // visor
    // Handlebars
    ctx.strokeStyle='#888'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(x+3,y+28); ctx.lineTo(x+27,y+28); ctx.stroke();
  }

  function drawObstacle(o){
    ctx.fillStyle=o.color[0]; ctx.beginPath(); ctx.roundRect(o.x,o.y,38,62,4); ctx.fill();
    ctx.fillStyle='rgba(0,0,0,0.5)'; ctx.fillRect(o.x+4,o.y+6,30,12);
    ctx.fillStyle='#111';
    ctx.beginPath(); ctx.arc(o.x+4,o.y+50,7,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(o.x+34,o.y+50,7,0,Math.PI*2); ctx.fill();
  }

  function draw(){
    ctx.fillStyle='#111'; ctx.fillRect(0,0,W,H);
    ctx.fillStyle='#0a2a0a'; ctx.fillRect(0,0,60,H); ctx.fillRect(W-60,0,60,H);
    ctx.fillStyle='#2a2a2a'; ctx.fillRect(60,0,W-120,H);
    ctx.setLineDash([25,18]); ctx.strokeStyle='rgba(255,200,0,0.3)'; ctx.lineWidth=1.5;
    [130,200,270].forEach(x=>{ctx.beginPath();ctx.moveTo(x,(roadOff%43)-43);ctx.lineTo(x,H);ctx.stroke();});
    ctx.setLineDash([]);
    ctx.strokeStyle='rgba(255,255,255,0.7)'; ctx.lineWidth=2.5;
    ctx.beginPath();ctx.moveTo(62,0);ctx.lineTo(62,H);ctx.stroke();
    ctx.beginPath();ctx.moveTo(W-62,0);ctx.lineTo(W-62,H);ctx.stroke();
    obstacles.forEach(o=>drawObstacle(o));
    drawBike(player.x,player.y);
    if(!running&&score>0){ctx.fillStyle='rgba(0,0,0,0.8)';ctx.fillRect(0,0,W,H);ctx.fillStyle='#ff6600';ctx.font='bold 28px Orbitron';ctx.textAlign='center';ctx.fillText('GAME OVER!',W/2,H/2-20);ctx.fillStyle='#fff';ctx.font='18px Exo 2';ctx.fillText('Score: '+score,W/2,H/2+15);ctx.textAlign='left';}
  }

  function update(){
    if(!running)return;
    roadOff+=speed; score++;
    if(score%400===0&&speed<13) speed+=0.5;
    const se=document.getElementById('brScore');if(se)se.textContent=score;
    const sp=document.getElementById('brSpeed');if(sp)sp.textContent=Math.floor(40+score/25);
    if(keys['ArrowLeft']||keys['a']||keys['A']) player.x=Math.max(65,player.x-5);
    if(keys['ArrowRight']||keys['d']||keys['D']) player.x=Math.min(W-100,player.x+5);
    if(Math.random()<0.017){const lane=LANES[Math.floor(Math.random()*LANES.length)];const col=OB_COLORS[Math.floor(Math.random()*OB_COLORS.length)];obstacles.push({x:lane-19,y:-80,color:col});}
    obstacles.forEach(o=>o.y+=speed*0.6);
    obstacles=obstacles.filter(o=>o.y<H+100);
    obstacles.forEach(o=>{
      if(player.x+25>o.x+3&&player.x+5<o.x+35&&player.y+20<o.y+60&&player.y+player.h>o.y+5){
        lives--;const lv=document.getElementById('brLives');if(lv)lv.textContent='‚ù§Ô∏è'.repeat(Math.max(0,lives));
        o.y=H+200; showToast(lives>0?`üí• Crash! ${lives} lives left`:'üíÄ Wipeout!');
        if(lives<=0)running=false;
      }
    });
    draw();
  }

  addListener(document,'keydown',e=>{keys[e.key]=true;});
  addListener(document,'keyup',e=>{keys[e.key]=false;});
  addListener(canvas,'touchstart',e=>{e.preventDefault();const r=canvas.getBoundingClientRect();keys[e.touches[0].clientX-r.left<W/2?'ArrowLeft':'ArrowRight']=true;},{passive:false});
  addListener(canvas,'touchend',()=>{keys['ArrowLeft']=false;keys['ArrowRight']=false;});

  window.brStart=function(){
    score=0;lives=3;speed=4;obstacles=[];player.x=W/2-15;running=true;
    const se=document.getElementById('brScore');if(se)se.textContent=0;
    const lv=document.getElementById('brLives');if(lv)lv.textContent='‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è';
    const sp=document.getElementById('brSpeed');if(sp)sp.textContent=40;
    const btn=document.getElementById('brBtn');if(btn)btn.textContent='Restart';
  };
  draw();
  startLoop(update);
}

/* ==============================================================
   GAME 14: STICKMAN RUN
============================================================== */
function buildStickman(c) {
  const W=500, H=300, GROUND=240;
  let running=false,score=0,best=0,speed=5,obstacles=[],frame=0;
  const p={x:70,y:GROUND,vy:0,jumping:false,alive:true};

  c.innerHTML=`
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="smScore">0</div><div class="g-score-lbl">Score</div></div>
      <div class="g-score-item"><div class="g-score-val" id="smBest">0</div><div class="g-score-lbl">Best</div></div>
    </div>
    <canvas id="smCanvas" class="g-canvas" width="${W}" height="${H}"></canvas>
    <div class="g-hint">SPACE / Click / Tap to jump! How far can you run?</div>
    <button class="g-btn" id="smBtn" onclick="smStart()">üèÉ Run!</button>
  `;
  const canvas=document.getElementById('smCanvas');
  const ctx=canvas.getContext('2d');

  function drawStick(x,y,f,alive){
    const lf=alive?Math.sin(f*0.3)*14:0;
    ctx.strokeStyle=alive?'#ff6600':'#ef4444';
    ctx.lineWidth=2.5; ctx.lineCap='round';
    // Head
    ctx.fillStyle=alive?'#ffd':'#ccc'; ctx.beginPath(); ctx.arc(x,y-52,11,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle=alive?'#ff6600':'#ef4444'; ctx.lineWidth=2; ctx.stroke();
    if(!alive){ctx.fillStyle='#ef4444';ctx.font='12px sans-serif';ctx.textAlign='center';ctx.fillText('‚úï',x-4,y-47);ctx.fillText('‚úï',x+4,y-47);ctx.textAlign='left';}
    // Body
    ctx.lineWidth=2.5; ctx.beginPath(); ctx.moveTo(x,y-40); ctx.lineTo(x,y-15); ctx.stroke();
    // Arms
    ctx.beginPath(); ctx.moveTo(x,y-33); ctx.lineTo(x-14+lf*0.5,y-22); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(x,y-33); ctx.lineTo(x+14-lf*0.5,y-22); ctx.stroke();
    // Legs
    ctx.beginPath(); ctx.moveTo(x,y-15); ctx.lineTo(x-10+lf,y); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(x,y-15); ctx.lineTo(x+10-lf,y); ctx.stroke();
  }

  function draw(){
    // Sky
    const sg=ctx.createLinearGradient(0,0,0,H);
    sg.addColorStop(0,'#0a0518'); sg.addColorStop(1,'#1a0a30');
    ctx.fillStyle=sg; ctx.fillRect(0,0,W,H);
    // Moon
    ctx.fillStyle='rgba(255,255,200,0.9)'; ctx.beginPath(); ctx.arc(W-50,30,16,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='rgba(0,0,20,0.4)'; ctx.beginPath(); ctx.arc(W-42,25,14,0,Math.PI*2); ctx.fill();
    // Stars
    ctx.fillStyle='rgba(255,255,255,0.6)';
    for(let i=0;i<20;i++) ctx.fillRect((i*73+score)%W,(i*47)%GROUND,1.5,1.5);
    // City silhouette
    ctx.fillStyle='#0a0a20';
    [40,100,160,220,280,340,400,460].forEach((bx,i)=>{
      const bh=40+i*12;
      ctx.fillRect(bx,GROUND+18-bh,30+i*3,bh);
      ctx.fillStyle='rgba(255,200,50,0.3)'; ctx.fillRect(bx+4,GROUND+18-bh+8,8,8);
      ctx.fillStyle='#0a0a20';
    });
    // Ground
    ctx.fillStyle='#2a1a0a'; ctx.fillRect(0,GROUND+18,W,H-GROUND);
    ctx.fillStyle='#ff6600'; ctx.fillRect(0,GROUND+18,W,3);
    // Track lines
    ctx.setLineDash([15,10]); ctx.strokeStyle='rgba(255,102,0,0.2)'; ctx.lineWidth=1;
    ctx.beginPath(); ctx.moveTo(0,GROUND+10); ctx.lineTo(W,GROUND+10); ctx.stroke();
    ctx.setLineDash([]);
    // Obstacles
    obstacles.forEach(o=>{
      if(o.type==='spike'){
        ctx.fillStyle='#888';
        for(let i=0;i<3;i++){ctx.beginPath();ctx.moveTo(o.x+i*12,GROUND+18);ctx.lineTo(o.x+i*12+6,GROUND-o.h+18);ctx.lineTo(o.x+i*12+12,GROUND+18);ctx.closePath();ctx.fill();}
      } else {
        ctx.fillStyle='#5a3a1a'; ctx.beginPath(); ctx.roundRect(o.x,GROUND+18-o.h,o.w,o.h,3); ctx.fill();
        ctx.strokeStyle='#8b5a30'; ctx.lineWidth=1.5; ctx.stroke();
      }
    });
    drawStick(p.x,p.y,frame,p.alive);
    if(!running&&score>0){
      ctx.fillStyle='rgba(0,0,0,0.75)'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle='#ff6600'; ctx.font='bold 26px Orbitron'; ctx.textAlign='center';
      ctx.fillText('üíÄ OUCH!', W/2,H/2-15);
      ctx.fillStyle='#fff'; ctx.font='17px Exo 2'; ctx.fillText('Score: '+score+' | Best: '+best,W/2,H/2+18);
      ctx.textAlign='left';
    }
  }

  function update(){
    if(!running)return;
    frame++; score++; speed=5+score/600;
    const se=document.getElementById('smScore');if(se)se.textContent=score;
    if(score>best){best=score;const be=document.getElementById('smBest');if(be)be.textContent=best;}
    p.vy+=0.55; p.y=Math.min(GROUND,p.y+p.vy);
    if(p.y>=GROUND){p.y=GROUND;p.vy=0;p.jumping=false;}
    if(Math.random()<0.018) obstacles.push({x:W+10,y:GROUND,h:22+Math.random()*22,w:10+Math.random()*16,type:Math.random()<0.4?'spike':'block'});
    obstacles.forEach(o=>o.x-=speed);
    obstacles=obstacles.filter(o=>o.x>-60);
    obstacles.forEach(o=>{
      if(p.x+12>o.x&&p.x-12<o.x+o.w&&p.y>GROUND+18-o.h&&p.y-55<GROUND+18){
        running=false; p.alive=false; showToast('üí• Hit! Score: '+score);
      }
    });
    draw();
  }

  function jump(){if(running&&!p.jumping){p.vy=-12.5;p.jumping=true;}}
  addListener(document,'keydown',e=>{if(e.key===' '||e.key==='ArrowUp'){e.preventDefault();jump();}});
  addListener(canvas,'click',jump);
  addListener(canvas,'touchstart',e=>{e.preventDefault();jump();},{passive:false});

  window.smStart=function(){
    score=0;speed=5;obstacles=[];p.x=70;p.y=GROUND;p.vy=0;p.jumping=false;p.alive=true;frame=0;running=true;
    const se=document.getElementById('smScore');if(se)se.textContent=0;
    const btn=document.getElementById('smBtn');if(btn)btn.textContent='Restart';
  };
  draw();
  startLoop(update);
}

/* ==============================================================
   GAME 15: SPACE BLASTER (Space Invaders)
============================================================== */
function buildSpaceship(c) {
  const W=500, H=420;
  let aliens=[], bullets=[], alientBullets=[], particles=[], score=0, lives=3, wave=1, running=false, mouseX=W/2;

  c.innerHTML=`
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="sbScore">0</div><div class="g-score-lbl">Score</div></div>
      <div class="g-score-item"><div class="g-score-val" id="sbLives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div><div class="g-score-lbl">Lives</div></div>
      <div class="g-score-item"><div class="g-score-val" id="sbWave">1</div><div class="g-score-lbl">Wave</div></div>
    </div>
    <canvas id="sbCanvas" class="g-canvas" width="${W}" height="${H}" style="cursor:crosshair"></canvas>
    <div class="g-hint">Move mouse to aim. Click to shoot! Spacebar also shoots!</div>
    <button class="g-btn" id="sbBtn" onclick="sbStart()">üöÄ Launch!</button>
  `;
  const canvas=document.getElementById('sbCanvas');
  const ctx=canvas.getContext('2d');
  const ship={x:W/2,y:H-40,w:30};
  let lastShot=0;

  function spawnWave(){
    aliens=[];
    const rows=2+Math.min(wave,4);
    for(let r=0;r<rows;r++) for(let col=0;col<8;col++)
      aliens.push({x:50+col*52,y:30+r*45,vx:1+wave*0.3,r:18,hp:1,hue:r*40+wave*20,alive:true,shootTimer:Math.random()*200});
  }

  function draw(){
    ctx.fillStyle='#000010'; ctx.fillRect(0,0,W,H);
    // Stars
    for(let i=0;i<60;i++){const b=0.2+Math.random()*0.6;ctx.fillStyle=`rgba(255,255,255,${b})`;ctx.fillRect((i*97+score/5)%W,(i*113+score/3)%H,b>0.5?2:1,b>0.5?2:1);}
    // Aliens
    aliens.forEach(a=>{
      if(!a.alive)return;
      const ag=ctx.createRadialGradient(a.x-4,a.y-4,0,a.x,a.y,a.r);
      ag.addColorStop(0,`hsl(${a.hue},80%,65%)`); ag.addColorStop(1,`hsl(${a.hue},60%,30%)`);
      ctx.fillStyle=ag; ctx.beginPath(); ctx.arc(a.x,a.y,a.r,0,Math.PI*2); ctx.fill();
      ctx.strokeStyle=`hsl(${a.hue},100%,70%)`; ctx.lineWidth=1; ctx.stroke();
      // Antenna
      ctx.strokeStyle=`hsl(${a.hue},80%,60%)`; ctx.lineWidth=1.5;
      ctx.beginPath(); ctx.moveTo(a.x-6,a.y-a.r); ctx.lineTo(a.x-9,a.y-a.r-8); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(a.x+6,a.y-a.r); ctx.lineTo(a.x+9,a.y-a.r-8); ctx.stroke();
      ctx.fillStyle=`hsl(${a.hue},100%,80%)`; ctx.beginPath(); ctx.arc(a.x-9,a.y-a.r-8,2.5,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(a.x+9,a.y-a.r-8,2.5,0,Math.PI*2); ctx.fill();
      // Eyes
      ctx.fillStyle='rgba(0,0,0,0.8)'; ctx.beginPath(); ctx.arc(a.x-7,a.y-3,5,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(a.x+7,a.y-3,5,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(a.x-7,a.y-3,2,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(a.x+7,a.y-3,2,0,Math.PI*2); ctx.fill();
    });
    // Player ship
    ship.x+=(mouseX-ship.x)*0.1;
    ctx.fillStyle='#ff6600';
    ctx.beginPath(); ctx.moveTo(ship.x,ship.y-22); ctx.lineTo(ship.x-18,ship.y+12); ctx.lineTo(ship.x+18,ship.y+12); ctx.closePath(); ctx.fill();
    ctx.fillStyle='#ff8833'; ctx.beginPath(); ctx.arc(ship.x,ship.y-5,8,0,Math.PI*2); ctx.fill();
    // Engine glow
    const eg=ctx.createRadialGradient(ship.x,ship.y+14,0,ship.x,ship.y+14,15);
    eg.addColorStop(0,'rgba(150,200,255,0.8)'); eg.addColorStop(1,'transparent');
    ctx.fillStyle=eg; ctx.beginPath(); ctx.arc(ship.x,ship.y+14,15,0,Math.PI*2); ctx.fill();
    // Player bullets
    bullets.forEach(b=>{
      const bg=ctx.createLinearGradient(b.x,b.y+12,b.x,b.y-8);
      bg.addColorStop(0,'rgba(255,215,0,0)'); bg.addColorStop(1,'#ffd700');
      ctx.fillStyle=bg; ctx.fillRect(b.x-2,b.y-8,4,20);
      ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(b.x,b.y,3,0,Math.PI*2); ctx.fill();
    });
    // Alien bullets
    alientBullets.forEach(b=>{
      ctx.fillStyle='#ef4444'; ctx.beginPath(); ctx.arc(b.x,b.y,4,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='rgba(239,68,68,0.3)'; ctx.beginPath(); ctx.arc(b.x,b.y,8,0,Math.PI*2); ctx.fill();
    });
    // Particles
    particles.forEach(p=>{ctx.globalAlpha=p.life;ctx.fillStyle=p.c;ctx.beginPath();ctx.arc(p.x,p.y,p.s*p.life,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;});
    if(!running&&score>0){ctx.fillStyle='rgba(0,0,0,0.8)';ctx.fillRect(0,0,W,H);ctx.fillStyle='#ff6600';ctx.font='bold 28px Orbitron';ctx.textAlign='center';ctx.fillText('DEFEATED!',W/2,H/2-15);ctx.fillStyle='#fff';ctx.font='18px Exo 2';ctx.fillText('Score: '+score,W/2,H/2+20);ctx.textAlign='left';}
  }

  function update(){
    if(!running)return;
    // Move aliens
    let bounced=false;
    aliens.forEach(a=>{if(a.alive){a.x+=a.vx;if((a.x>W-20||a.x<20)&&!bounced){aliens.forEach(aa=>{if(aa.alive){aa.vx*=-1;aa.y+=15;}});bounced=true;}a.shootTimer--;if(a.shootTimer<=0){alientBullets.push({x:a.x,y:a.y+a.r,vy:3+wave*0.4});a.shootTimer=120+Math.random()*180;}}});
    bullets.forEach(b=>b.y-=12);
    alientBullets.forEach(b=>b.y+=b.vy);
    // Bullet-alien collision
    for(let bi=bullets.length-1;bi>=0;bi--){
      for(let ai=aliens.length-1;ai>=0;ai--){
        if(!aliens[ai].alive)continue;
        const dx=bullets[bi].x-aliens[ai].x,dy=bullets[bi].y-aliens[ai].y;
        if(Math.sqrt(dx*dx+dy*dy)<aliens[ai].r+4){
          for(let i=0;i<8;i++) particles.push({x:aliens[ai].x,y:aliens[ai].y,vx:(Math.random()-0.5)*8,vy:(Math.random()-0.5)*8,c:`hsl(${aliens[ai].hue},80%,60%)`,s:4+Math.random()*4,life:1});
          aliens[ai].alive=false; bullets.splice(bi,1);
          score+=10+wave*5;const se=document.getElementById('sbScore');if(se)se.textContent=score;
          break;
        }
      }
    }
    // Alien bullet-ship collision
    for(let bi=alientBullets.length-1;bi>=0;bi--){
      const b=alientBullets[bi];
      if(Math.abs(b.x-ship.x)<20&&b.y>ship.y-20&&b.y<ship.y+12){
        alientBullets.splice(bi,1); lives--;
        const lv=document.getElementById('sbLives');if(lv)lv.textContent='‚ù§Ô∏è'.repeat(Math.max(0,lives));
        showToast(lives>0?`üí• Hit! ${lives} lives left`:'üíÄ Ship destroyed!');
        if(lives<=0){running=false;}
      }
    }
    bullets=bullets.filter(b=>b.y>-20);
    alientBullets=alientBullets.filter(b=>b.y<H+20);
    particles.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.life-=0.04;});
    particles=particles.filter(p=>p.life>0);
    if(aliens.some(a=>a.alive&&a.y>H-60)){running=false;showToast('üò± Aliens invaded! Score: '+score);}
    if(!aliens.some(a=>a.alive)){wave++;const we=document.getElementById('sbWave');if(we)we.textContent=wave;spawnWave();showToast('Wave '+wave+'! Incoming!');}
    draw();
  }

  addListener(canvas,'mousemove',e=>{const r=canvas.getBoundingClientRect();mouseX=e.clientX-r.left;});
  addListener(canvas,'click',()=>{if(!running)return;const now=Date.now();if(now-lastShot<250)return;lastShot=now;bullets.push({x:ship.x,y:ship.y-22});});
  addListener(document,'keydown',e=>{if(e.key===' '&&running){e.preventDefault();const now=Date.now();if(now-lastShot<250)return;lastShot=now;bullets.push({x:ship.x,y:ship.y-22});}});
  addListener(canvas,'touchmove',e=>{e.preventDefault();const r=canvas.getBoundingClientRect();mouseX=e.touches[0].clientX-r.left;},{passive:false});
  addListener(canvas,'touchend',()=>{if(!running)return;const now=Date.now();if(now-lastShot<250)return;lastShot=now;bullets.push({x:ship.x,y:ship.y-22});});

  window.sbStart=function(){
    score=0;lives=3;wave=1;aliens=[];bullets=[];alientBullets=[];particles=[];running=true;
    const se=document.getElementById('sbScore');if(se)se.textContent=0;
    const lv=document.getElementById('sbLives');if(lv)lv.textContent='‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è';
    const we=document.getElementById('sbWave');if(we)we.textContent=1;
    const btn=document.getElementById('sbBtn');if(btn)btn.textContent='Restart';
    spawnWave();
  };
  draw();
  startLoop(update);
}

/* ==============================================================
   GAME 16: MEMORY CARDS
============================================================== */
function buildMemory(c) {
  const emojis=['üéÆ','üèÜ','üî•','‚≠ê','üöÄ','üéØ','üíé','üåü','üçÄ','üé™'];
  let cards=[], flipped=[], matched=0, moves=0, locked=false, timer=0, timerInt;

  function init(pairs=8){
    const pool=emojis.slice(0,pairs);
    const deck=[...pool,...pool].sort(()=>Math.random()-0.5);
    cards=deck.map((e,i)=>({id:i,emoji:e,revealed:false,matched:false}));
    flipped=[];matched=0;moves=0;locked=false;timer=0;
    clearInterval(timerInt);
    timerInt=addInterval(()=>{timer++;const te=document.getElementById('memTimer');if(te)te.textContent=timer+'s';},1000);
    render();
  }

  const COLS=4;
  c.innerHTML=`
    <div class="g-scorebar">
      <div class="g-score-item"><div class="g-score-val" id="memMoves">0</div><div class="g-score-lbl">Moves</div></div>
      <div class="g-score-item"><div class="g-score-val" id="memMatched">0</div><div class="g-score-lbl">Matched</div></div>
      <div class="g-score-item"><div class="g-score-val" id="memTimer">0s</div><div class="g-score-lbl">Time</div></div>
    </div>
    <div id="memBoard" style="display:grid;grid-template-columns:repeat(${COLS},1fr);gap:8px;max-width:360px;"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;">
      <button class="g-btn" onclick="buildMemory(document.getElementById('gc'))">New Game</button>
      <button class="g-btn secondary" onclick="memRevealAll()">Show All (3s)</button>
    </div>
    <div class="g-hint">Match all pairs to win! Fewer moves = better score!</div>
  `;

  function render(){
    const board=document.getElementById('memBoard');if(!board)return;
    board.innerHTML=cards.map((card,i)=>`
      <div onclick="memFlip(${i})" style="height:80px;border-radius:10px;border:2px solid ${card.matched?'#22c55e':card.revealed?'var(--orange)':'rgba(255,255,255,0.08)'};background:${card.matched?'rgba(34,197,94,0.1)':card.revealed?'rgba(255,102,0,0.1)':'var(--card2)'};display:flex;align-items:center;justify-content:center;font-size:${card.revealed||card.matched?'2rem':'1.5rem'};cursor:pointer;transition:all 0.25s;box-shadow:${card.matched?'0 0 12px rgba(34,197,94,0.3)':card.revealed?'0 0 12px rgba(255,102,0,0.2)':'none'};">${card.revealed||card.matched?card.emoji:'<span style="color:rgba(255,255,255,0.2)">?</span>'}</div>
    `).join('');
    const mm=document.getElementById('memMoves');if(mm)mm.textContent=moves;
    const mn=document.getElementById('memMatched');if(mn)mn.textContent=matched;
  }

  window.memFlip=function(i){
    if(locked||cards[i].revealed||cards[i].matched)return;
    cards[i].revealed=true; flipped.push(i); render();
    if(flipped.length===2){
      moves++; locked=true;
      const [a,b]=flipped;
      if(cards[a].emoji===cards[b].emoji){
        cards[a].matched=cards[b].matched=true; matched++; flipped=[]; locked=false;
        if(matched===emojis.length){clearInterval(timerInt);showToast('üéâ All matched! Moves: '+moves+' Time: '+timer+'s');}
        render();
      } else {
        setTimeout(()=>{cards[a].revealed=cards[b].revealed=false;flipped=[];locked=false;render();},900);
      }
    }
  };

  window.memRevealAll=function(){
    if(locked)return;locked=true;cards.forEach(c2=>c2.revealed=true);render();
    setTimeout(()=>{cards.forEach(c2=>{if(!c2.matched)c2.revealed=false;});render();locked=false;},3000);
  };

  init();
}
</script>
</body>
</html>
